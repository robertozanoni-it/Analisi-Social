<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analizzatore Creativo Strategico V2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap');
        
        body { font-family: 'Inter', sans-serif; background-color: #f1f5f9; }
        .glass-card { background: white; border: 1px solid #e2e8f0; border-radius: 1.5rem; box-shadow: 0 10px 25px -5px rgba(0,0,0,0.05); }
        .pnl-badge { font-size: 0.65rem; font-weight: 800; padding: 3px 12px; border-radius: 99px; text-transform: uppercase; letter-spacing: 0.05em; }
        .loader { border: 3px solid #f3f3f3; border-top: 3px solid #6366f1; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        .heatmap-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; mix-blend-mode: overlay; opacity: 0.7; display: none; filter: blur(15px); }
        .audit-card { border-left-width: 6px; padding: 1.25rem; border-radius: 1rem; margin-bottom: 1rem; transition: transform 0.2s; }
        .audit-card:hover { transform: scale(1.02); }
        .audit-ok { background-color: #f0fdf4; border-color: #22c55e; color: #166534; }
        .audit-ko { background-color: #fef2f2; border-color: #ef4444; color: #991b1b; }
        
        .tab-active { border-bottom: 3px solid #6366f1; color: #6366f1; }
    </style>
</head>
<body class="p-4 md:p-8">

    <!-- View: Caricamento -->
    <div id="upload-view" class="max-w-3xl mx-auto mt-16 text-center space-y-10">
        <div class="space-y-4">
            <h1 class="text-5xl font-black text-slate-900 tracking-tighter uppercase italic">Creative <span class="text-indigo-600">Pro</span> Audit</h1>
            <p class="text-slate-500 text-lg max-w-xl mx-auto font-medium">L'intelligenza artificiale che analizza i tuoi contenuti con gli occhi di un esperto di Neuromarketing e SEO.</p>
        </div>

        <div id="dropZone" class="glass-card p-20 border-2 border-dashed border-slate-300 cursor-pointer hover:border-indigo-500 hover:bg-white transition-all group">
            <div class="bg-indigo-50 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6 group-hover:scale-110 transition-transform">
                <i class="fas fa-rocket text-3xl text-indigo-500"></i>
            </div>
            <p class="font-bold text-slate-700 text-xl tracking-tight">Trascina il post o clicca per iniziare</p>
            <p class="text-sm text-slate-400 mt-2">Analisi automatica di: Visual, PNL Copy, SEO Rank & CRO</p>
            <input type="file" id="fileInput" class="hidden" accept="image/*">
            <button onclick="document.getElementById('fileInput').click()" class="mt-8 bg-slate-900 text-white px-10 py-4 rounded-2xl font-black uppercase tracking-widest text-xs shadow-xl hover:bg-indigo-600 transition">Carica File</button>
        </div>
    </div>

    <!-- View: Loading -->
    <div id="loading-view" class="hidden flex flex-col items-center justify-center mt-48 space-y-6">
        <div class="loader"></div>
        <div class="text-center">
            <p class="text-slate-900 font-black uppercase tracking-widest">Generazione Report...</p>
            <p class="text-slate-400 text-sm italic mt-1">Stiamo mappando i pattern di attenzione dell'utente</p>
        </div>
    </div>

    <!-- View: Analisi -->
    <div id="analysis-view" class="hidden max-w-7xl mx-auto space-y-8 animate-in fade-in duration-500">
        <header class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 border-b border-slate-200 pb-8">
            <div>
                <div class="flex items-center gap-2 mb-2">
                    <span class="bg-indigo-600 text-white text-[10px] font-black px-3 py-1 rounded-full uppercase tracking-tighter">Live Report</span>
                    <p id="fileNameDisplay" class="text-slate-400 text-[10px] font-black uppercase tracking-widest"></p>
                </div>
                <h2 class="text-3xl font-black text-slate-900 uppercase italic leading-none">Creative <span class="text-indigo-600">Evolution</span> Analysis</h2>
            </div>
            <div class="flex gap-3">
                <button onclick="window.print()" class="bg-white border border-slate-200 px-5 py-3 rounded-xl text-[10px] font-black text-slate-700 uppercase hover:bg-slate-50 transition"><i class="fas fa-download mr-2"></i>Esporta PDF</button>
                <button onclick="location.reload()" class="bg-slate-900 text-white px-5 py-3 rounded-xl text-[10px] font-black uppercase hover:bg-indigo-600 transition"><i class="fas fa-plus mr-2"></i>Nuovo Post</button>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            
            <!-- Sinistra: Audit & Visual -->
            <div class="lg:col-span-4 space-y-8">
                
                <div class="glass-card p-5">
                    <div class="flex justify-between items-center mb-4">
                        <span class="text-[10px] font-black uppercase text-slate-400 tracking-wider">Predictive Attention Map</span>
                        <button onclick="toggleHeatmap()" class="text-[10px] border border-indigo-200 text-indigo-600 px-4 py-1.5 rounded-full font-black uppercase hover:bg-indigo-50 transition">Heatmap On/Off</button>
                    </div>
                    <div class="relative rounded-2xl overflow-hidden bg-slate-100 aspect-square flex items-center justify-center border border-slate-100 shadow-inner" id="imgContainer">
                        <img id="previewImg" class="w-full h-full object-contain">
                        <canvas id="heatmapLayer" class="heatmap-overlay"></canvas>
                    </div>
                </div>

                <div class="glass-card p-8 bg-indigo-600 text-white relative overflow-hidden">
                    <div class="relative z-10">
                        <h3 class="text-[10px] font-black uppercase tracking-[0.2em] mb-4 opacity-70">Impact Score</h3>
                        <div class="flex items-end gap-2">
                            <span id="scoreValue" class="text-7xl font-black leading-none tracking-tighter">--</span>
                            <span class="text-2xl font-bold opacity-50 mb-1">/100</span>
                        </div>
                        <p id="scoreLabel" class="text-xs font-black mt-4 uppercase tracking-widest bg-white/20 inline-block px-4 py-1.5 rounded-full border border-white/20"></p>
                    </div>
                    <i class="fas fa-brain absolute -bottom-8 -right-8 text-indigo-500 text-[10rem] opacity-30 rotate-12"></i>
                </div>

                <div class="space-y-4">
                    <h3 class="text-[10px] font-black uppercase tracking-[0.2em] text-slate-400">Deep Audit Findings</h3>
                    <div id="auditList"></div>
                </div>
            </div>

            <!-- Destra: Strategia, Copy e SEO -->
            <div class="lg:col-span-8 space-y-8">
                
                <!-- Tab Menu (Simulazione) -->
                <div class="flex gap-8 border-b border-slate-200">
                    <button class="pb-4 text-xs font-black uppercase tracking-widest tab-active">Strategia Copy</button>
                    <button class="pb-4 text-xs font-black uppercase tracking-widest text-slate-400 hover:text-slate-600 transition">Performance SEO</button>
                    <button class="pb-4 text-xs font-black uppercase tracking-widest text-slate-400 hover:text-slate-600 transition">Competitor Trend</button>
                </div>

                <div class="glass-card p-10">
                    <div class="flex items-center gap-4 mb-10">
                        <div class="h-1.5 w-16 bg-indigo-600 rounded-full"></div>
                        <h3 class="text-xl font-black text-slate-900 tracking-tight">Revisione Ottimizzata per Conversione</h3>
                    </div>
                    
                    <div id="copyOptions" class="grid grid-cols-1 md:grid-cols-1 gap-6">
                        <!-- Qui verranno inserite le opzioni di copy -->
                    </div>
                </div>

                <!-- Box WordPress/Elementor + SEO Keywords -->
                <div class="bg-slate-900 text-white p-12 rounded-[3rem] shadow-2xl relative overflow-hidden">
                    <div class="relative z-10">
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
                            <div>
                                <h4 class="text-indigo-400 text-[10px] font-black uppercase tracking-[0.4em] mb-6">Implementazione Elementor</h4>
                                <div id="elementorTips" class="space-y-4"></div>
                                
                                <h4 class="text-emerald-400 text-[10px] font-black uppercase tracking-[0.4em] mt-10 mb-6">Target SEO Keywords</h4>
                                <div id="seoKeywords" class="flex flex-wrap gap-2"></div>
                            </div>
                            <div class="bg-white/5 p-6 rounded-[2rem] border border-white/10 backdrop-blur-md">
                                <p class="text-[10px] font-black uppercase text-indigo-300 mb-4 text-center">Analisi Multidimensionale</p>
                                <canvas id="radarChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const apiKey = "";
        const fileInput = document.getElementById('fileInput');
        const dropZone = document.getElementById('dropZone');
        const uploadView = document.getElementById('upload-view');
        const loadingView = document.getElementById('loading-view');
        const analysisView = document.getElementById('analysis-view');
        const previewImg = document.getElementById('previewImg');
        
        let radarChart = null;

        fileInput.addEventListener('change', (e) => handleFile(e.target.files[0]));
        dropZone.addEventListener('click', () => fileInput.click());
        dropZone.addEventListener('dragover', (e) => { e.preventDefault(); dropZone.classList.add('border-indigo-500', 'bg-indigo-50'); });
        dropZone.addEventListener('dragleave', () => dropZone.classList.remove('border-indigo-500', 'bg-indigo-50'));
        dropZone.addEventListener('drop', (e) => { e.preventDefault(); handleFile(e.dataTransfer.files[0]); });

        function handleFile(file) {
            if (!file || !file.type.startsWith('image/')) return;
            document.getElementById('fileNameDisplay').innerText = `Progetto: ${file.name.toUpperCase()}`;
            const reader = new FileReader();
            reader.onload = (e) => {
                previewImg.src = e.target.result;
                runAnalysis(e.target.result);
            };
            reader.readAsDataURL(file);
        }

        async function runAnalysis(base64) {
            uploadView.classList.add('hidden');
            loadingView.classList.remove('hidden');

            const prompt = `Sei un esperto senior di Neuromarketing, PNL e SEO Specialist. Analizza questo post social.
            Restituisci ESCLUSIVAMENTE un JSON valido con questa struttura:
            {
                "score": 82,
                "label": "Ottimo Potenziale",
                "scores": {"SEO": 75, "PNL": 85, "UX": 70, "Visual": 90, "CTA": 65},
                "audit": {
                    "positivi": [{"titolo": "Visual Impact", "desc": "L'immagine cattura subito l'attenzione."}],
                    "negativi": [{"titolo": "Weak CTA", "desc": "Il tasto non risalta abbastanza."}]
                },
                "copy_options": [
                    {"type": "Authority PNL", "text": "...", "impact": "+30%"},
                    {"type": "Sensory Acuity", "text": "...", "impact": "+45%"}
                ],
                "seo_keywords": ["keyword 1", "keyword 2", "keyword 3"],
                "elementor_tips": ["Usa il widget X...", "Imposta l'id X..."]
            }`;

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        contents: [{
                            parts: [
                                {text: prompt},
                                {inlineData: {mimeType: "image/png", data: base64.split(',')[1]}}
                            ]
                        }],
                        generationConfig: { responseMimeType: "application/json" }
                    })
                });

                const data = await response.json();
                const analysis = JSON.parse(data.candidates[0].content.parts[0].text);
                renderResults(analysis);
            } catch (err) {
                console.error(err);
                alert("Analisi fallita. Riprova con un altro file.");
                location.reload();
            }
        }

        function renderResults(data) {
            loadingView.classList.add('hidden');
            analysisView.classList.remove('hidden');

            document.getElementById('scoreValue').innerText = data.score;
            document.getElementById('scoreLabel').innerText = data.label;

            // Audit
            const auditContainer = document.getElementById('auditList');
            auditContainer.innerHTML = [
                ...data.audit.positivi.map(i => `<div class="audit-card audit-ok"><p class="text-[10px] font-black uppercase mb-1">OK: ${i.titolo}</p><p class="text-[11px]">${i.desc}</p></div>`),
                ...data.audit.negativi.map(i => `<div class="audit-card audit-ko"><p class="text-[10px] font-black uppercase mb-1">FIX: ${i.titolo}</p><p class="text-[11px]">${i.desc}</p></div>`)
            ].join('');

            // Copy
            document.getElementById('copyOptions').innerHTML = data.copy_options.map(opt => `
                <div class="p-8 border border-slate-100 rounded-[2rem] bg-slate-50/50 hover:bg-white transition-all shadow-sm">
                    <div class="flex justify-between items-center mb-6">
                        <span class="pnl-badge bg-slate-900 text-white">${opt.type}</span>
                        <span class="text-[10px] font-black text-indigo-600">Expected: ${opt.impact}</span>
                    </div>
                    <p class="text-lg leading-relaxed text-slate-800 font-medium italic">"${opt.text}"</p>
                </div>
            `).join('');

            // Keywords
            document.getElementById('seoKeywords').innerHTML = data.seo_keywords.map(kw => `
                <span class="bg-emerald-500/20 text-emerald-400 px-3 py-1 rounded-lg text-[10px] font-black uppercase border border-emerald-500/30">#${kw}</span>
            `).join('');

            // Tips Elementor
            document.getElementById('elementorTips').innerHTML = data.elementor_tips.map(tip => `
                <div class="flex items-center gap-4 text-xs text-slate-400 group">
                    <div class="h-6 w-6 rounded-full bg-indigo-600/20 flex items-center justify-center flex-shrink-0 text-indigo-400">
                        <i class="fas fa-layer-group text-[10px]"></i>
                    </div>
                    <span>${tip}</span>
                </div>
            `).join('');

            initRadar(data.scores);
            drawHeatmap();
        }

        function initRadar(scores) {
            if (radarChart) radarChart.destroy();
            const ctx = document.getElementById('radarChart').getContext('2d');
            radarChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: Object.keys(scores),
                    datasets: [{
                        data: Object.values(scores),
                        backgroundColor: 'rgba(99, 102, 241, 0.5)',
                        borderColor: '#818cf8',
                        borderWidth: 4,
                        pointRadius: 4,
                        pointBackgroundColor: '#fff'
                    }]
                },
                options: {
                    scales: { 
                        r: { 
                            display: true,
                            min: 0, 
                            max: 100,
                            ticks: { display: false },
                            grid: { color: 'rgba(255,255,255,0.1)' },
                            angleLines: { color: 'rgba(255,255,255,0.1)' },
                            pointLabels: { color: 'rgba(255,255,255,0.7)', font: { size: 10, weight: '800' } }
                        } 
                    },
                    plugins: { legend: { display: false } }
                }
            });
        }

        function drawHeatmap() {
            const canvas = document.getElementById('heatmapLayer');
            const container = document.getElementById('imgContainer');
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;
            const ctx = canvas.getContext('2d');
            const grads = [
                {x: 0.5, y: 0.3, r: 120, c: 'rgba(255,0,0,0.8)'},
                {x: 0.4, y: 0.6, r: 90, c: 'rgba(255,255,0,0.5)'},
                {x: 0.7, y: 0.4, r: 100, c: 'rgba(0,255,0,0.3)'}
            ];
            grads.forEach(g => {
                const grad = ctx.createRadialGradient(g.x*canvas.width, g.y*canvas.height, 0, g.x*canvas.width, g.y*canvas.height, g.r);
                grad.addColorStop(0, g.c); grad.addColorStop(1, 'transparent');
                ctx.fillStyle = grad; ctx.fillRect(0,0, canvas.width, canvas.height);
            });
        }

        function toggleHeatmap() {
            const layer = document.getElementById('heatmapLayer');
            layer.style.display = (layer.style.display === 'block' || layer.style.display === '') ? 'none' : 'block';
        }
    </script>
</body>
</html>
