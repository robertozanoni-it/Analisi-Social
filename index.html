<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Creative Evolution Ultimate - SEO & Imagen AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap');
        
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #0f172a; color: #f8fafc; }
        .glass-dark { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(16px); border: 1px solid rgba(255,255,255,0.05); }
        .accent-gradient { background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%); }
        
        .loader-ring { width: 48px; height: 48px; border: 5px solid #1e293b; border-bottom-color: #6366f1; border-radius: 50%; display: inline-block; box-sizing: border-box; animation: rotation 1s linear infinite; }
        @keyframes rotation { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        .tab-active { border-bottom: 2px solid #6366f1; color: #6366f1; }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }

        .device-frame { transition: all 0.4s ease; border: 8px solid #334155; }
        .mobile-mode { width: 320px !important; height: 580px !important; border-radius: 40px; }
    </style>
</head>
<body class="antialiased min-h-screen">

    <!-- Header -->
    <header class="sticky top-0 z-50 glass-dark border-b border-slate-800 px-6 py-4">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="accent-gradient p-2 rounded-xl text-white shadow-lg shadow-indigo-500/20">
                    <i class="fas fa-bolt"></i>
                </div>
                <h1 class="font-black text-xl tracking-tighter uppercase italic">Creative<span class="text-indigo-400">Hub</span></h1>
            </div>
            <div id="topActions" class="hidden flex items-center gap-4">
                <button onclick="location.reload()" class="text-xs font-bold uppercase text-slate-400 hover:text-white transition">Nuovo Test</button>
                <button onclick="window.print()" class="bg-indigo-600 hover:bg-indigo-500 text-white px-4 py-2 rounded-lg text-[10px] font-black uppercase tracking-widest transition shadow-lg shadow-indigo-500/20">
                    Esporta PDF
                </button>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto p-6">
        
        <!-- Welcome/Upload Section -->
        <div id="uploadArea" class="py-20 text-center max-w-3xl mx-auto animate-in fade-in duration-700">
            <h2 class="text-6xl font-extrabold tracking-tight mb-6 bg-clip-text text-transparent bg-gradient-to-r from-white to-slate-500">
                Ottimizza il tuo <br>Digital Asset.
            </h2>
            <p class="text-slate-400 text-lg mb-12">Analisi AI integrata: SEO, PNL e Design Strategy per esperti WordPress ed Elementor.</p>
            
            <div id="dropZone" class="glass-dark border-2 border-dashed border-slate-700 rounded-[3rem] p-16 cursor-pointer hover:border-indigo-500 hover:bg-slate-800/50 transition-all group">
                <input type="file" id="fileInput" class="hidden" accept="image/*">
                <div class="flex flex-col items-center">
                    <div class="w-20 h-20 rounded-full bg-slate-800 flex items-center justify-center mb-6 group-hover:scale-110 transition">
                        <i class="fas fa-upload text-2xl text-indigo-400"></i>
                    </div>
                    <p class="text-xl font-bold">Trascina qui la tua grafica</p>
                    <p class="text-sm text-slate-500 mt-2">Analizzeremo colori, copy e potenziale SEO</p>
                </div>
            </div>
        </div>

        <!-- Loading State -->
        <div id="loadingState" class="hidden py-40 text-center">
            <span class="loader-ring mb-8"></span>
            <h3 class="text-indigo-400 font-black tracking-[0.3em] uppercase animate-pulse">Deep Analysis In Progress</h3>
            <p class="text-slate-500 text-sm mt-4">Stiamo interrogando il modello Gemini 2.5 Flash...</p>
        </div>

        <!-- Dashboard -->
        <div id="dashboard" class="hidden grid grid-cols-1 lg:grid-cols-12 gap-8 animate-in fade-in slide-in-from-bottom-8 duration-700">
            
            <!-- Sidebar: Asset & Score -->
            <div class="lg:col-span-4 space-y-8">
                <div class="glass-dark rounded-[2.5rem] p-6 border border-slate-800 shadow-2xl">
                    <div class="flex justify-between items-center mb-6">
                        <span class="text-[10px] font-black uppercase tracking-widest text-slate-500">Asset Preview</span>
                        <div class="flex gap-2">
                            <button id="toggleMobile" class="w-8 h-8 rounded-lg bg-slate-800 text-slate-400 hover:text-white flex items-center justify-center transition">
                                <i class="fas fa-mobile-alt"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div id="imgFrame" class="device-frame bg-slate-900 rounded-2xl overflow-hidden aspect-video relative flex items-center justify-center mx-auto">
                        <img id="mainImage" class="w-full h-full object-contain">
                    </div>

                    <div class="mt-8 grid grid-cols-2 gap-4">
                        <div class="bg-slate-800/50 p-4 rounded-2xl text-center">
                            <span class="block text-[10px] font-black text-slate-500 uppercase">Impact Score</span>
                            <span id="scoreText" class="text-3xl font-black text-indigo-400">--</span>
                        </div>
                        <div class="bg-slate-800/50 p-4 rounded-2xl text-center">
                            <span class="block text-[10px] font-black text-slate-500 uppercase">SEO Rank</span>
                            <span id="seoRank" class="text-3xl font-black text-purple-400">--</span>
                        </div>
                    </div>
                </div>

                <!-- Color & Psychology -->
                <div class="glass-dark rounded-[2.5rem] p-8 border border-slate-800">
                    <h4 class="text-xs font-black uppercase tracking-widest text-indigo-400 mb-6">Analisi Cromatica</h4>
                    <div id="colorContainer" class="flex gap-3 mb-6"></div>
                    <p id="psychologyNote" class="text-xs leading-relaxed text-slate-400 italic"></p>
                </div>
            </div>

            <!-- Content Area -->
            <div class="lg:col-span-8 space-y-8">
                
                <!-- Performance Radar & Insights -->
                <div class="glass-dark rounded-[3rem] p-10 border border-slate-800 grid grid-cols-1 md:grid-cols-2 gap-10">
                    <div class="h-64 flex items-center justify-center">
                        <canvas id="radarChart"></canvas>
                    </div>
                    <div class="space-y-4">
                        <h3 class="text-2xl font-black">Strategic Insight</h3>
                        <p id="strategicSummary" class="text-slate-400 text-sm leading-relaxed"></p>
                        <div id="badgeList" class="flex flex-wrap gap-2 pt-4"></div>
                    </div>
                </div>

                <!-- Tabs Section -->
                <div class="glass-dark rounded-[3rem] p-10 border border-slate-800">
                    <div class="flex gap-8 border-b border-slate-800 mb-8 overflow-x-auto no-scrollbar">
                        <button onclick="showTab('seo')" id="tab-seo" class="tab-active pb-4 text-[10px] font-black uppercase tracking-widest transition">SEO & Content</button>
                        <button onclick="showTab('pnl')" id="tab-pnl" class="pb-4 text-[10px] font-black uppercase tracking-widest text-slate-500 transition">PNL & Copy</button>
                        <button onclick="showTab('ai')" id="tab-ai" class="pb-4 text-[10px] font-black uppercase tracking-widest text-slate-500 transition">AI Creative Labs</button>
                    </div>

                    <!-- SEO Tab -->
                    <div id="content-seo" class="space-y-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="bg-slate-800/30 p-6 rounded-3xl border border-slate-700">
                                <label class="text-[9px] font-black uppercase text-indigo-400">SEO Alt Text (WP)</label>
                                <p id="seoAlt" class="mt-2 text-sm text-slate-300 font-medium"></p>
                            </div>
                            <div class="bg-slate-800/30 p-6 rounded-3xl border border-slate-700">
                                <label class="text-[9px] font-black uppercase text-purple-400">Search Intent</label>
                                <p id="seoIntent" class="mt-2 text-sm text-slate-300 font-bold uppercase tracking-wide"></p>
                            </div>
                        </div>
                        <div id="keywordCloud" class="flex flex-wrap gap-2"></div>
                    </div>

                    <!-- PNL Tab -->
                    <div id="content-pnl" class="hidden space-y-6">
                        <div id="copySuggestions" class="space-y-4"></div>
                        <div class="mt-8 p-6 bg-indigo-900/20 rounded-3xl border border-indigo-500/20">
                            <div class="flex justify-between items-center mb-4">
                                <h5 class="text-xs font-black uppercase text-indigo-400">Audio Preview (TTS)</h5>
                                <button onclick="playPreview()" class="h-10 w-10 rounded-full bg-indigo-600 flex items-center justify-center hover:bg-indigo-500 transition">
                                    <i class="fas fa-play text-xs"></i>
                                </button>
                            </div>
                            <p id="ttsScript" class="text-xs text-slate-400 italic">Clicca play per ascoltare il tono di voce suggerito.</p>
                        </div>
                    </div>

                    <!-- AI Generation Tab -->
                    <div id="content-ai" class="hidden space-y-6">
                        <div class="text-center py-6">
                            <h5 class="text-lg font-bold mb-2">Generatore di Varianti Creativa</h5>
                            <p class="text-sm text-slate-400 mb-8">Usa Imagen 4.0 per creare un'alternativa ottimizzata basata sui dati dell'analisi.</p>
                            <button id="generateBtn" class="accent-gradient px-8 py-4 rounded-2xl font-black uppercase text-xs tracking-[0.2em] shadow-xl hover:scale-105 transition">
                                <i class="fas fa-magic mr-3"></i> Genera Variante
                            </button>
                        </div>
                        <div id="generatedImageArea" class="hidden flex flex-col items-center">
                            <div class="w-full max-w-md aspect-square rounded-3xl bg-slate-800 overflow-hidden shadow-2xl" id="genLoading">
                                <div class="w-full h-full flex items-center justify-center bg-slate-800 animate-pulse">
                                    <i class="fas fa-sparkles text-3xl text-indigo-500"></i>
                                </div>
                            </div>
                            <img id="genResult" class="hidden w-full max-w-md aspect-square rounded-3xl object-cover shadow-2xl">
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </main>

    <script>
        const apiKey = "";
        let radarChart = null;
        let currentAnalysis = null;

        // UI Handlers
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        
        dropZone.onclick = () => fileInput.click();
        fileInput.onchange = (e) => {
            if (e.target.files[0]) handleUpload(e.target.files[0]);
        };

        function handleUpload(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                document.getElementById('mainImage').src = e.target.result;
                startAnalysis(e.target.result);
            };
            reader.readAsDataURL(file);
        }

        async function startAnalysis(base64) {
            document.getElementById('uploadArea').classList.add('hidden');
            document.getElementById('loadingState').classList.remove('hidden');

            const prompt = `Analizza come esperto SEO e PNL. Restituisci JSON: 
            {
                "score": 0-100, "seo_rank": 0-100, 
                "radar": {"SEO":0,"PNL":0,"UX":0,"Visual":0,"Conv":0},
                "summary": "...", "badges": ["Punto di forza"],
                "colors": [{"hex": "#...", "p": "30%"}], "psychology": "...",
                "seo": {"alt": "...", "intent": "TRANSAZIONALE", "keywords": ["..."]},
                "pnl": [{"type": "Pattern Interrupt", "text": "...", "impact": "High"}],
                "tts": "Script audio ottimizzato...",
                "gen_prompt": "Prompt dettagliato per Imagen 4.0 per migliorare questa immagine"
            }`;

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        contents: [{
                            parts: [
                                {text: "Analizza strategicamente questo asset per un web designer/copywriter."},
                                {inlineData: {mimeType: "image/png", data: base64.split(',')[1]}}
                            ]
                        }],
                        systemInstruction: { parts: [{ text: prompt }] },
                        generationConfig: { responseMimeType: "application/json" }
                    })
                });

                const resData = await response.json();
                currentAnalysis = JSON.parse(resData.candidates[0].content.parts[0].text);
                renderDashboard(currentAnalysis);
            } catch (err) {
                console.error(err);
                alert("Errore durante l'analisi.");
            }
        }

        function renderDashboard(data) {
            document.getElementById('loadingState').classList.add('hidden');
            document.getElementById('dashboard').classList.remove('hidden');
            document.getElementById('topActions').classList.remove('hidden');

            document.getElementById('scoreText').innerText = data.score + "%";
            document.getElementById('seoRank').innerText = data.seo_rank + "%";
            document.getElementById('strategicSummary').innerText = data.summary;
            document.getElementById('seoAlt').innerText = data.seo.alt;
            document.getElementById('seoIntent').innerText = data.seo.intent;
            document.getElementById('psychologyNote').innerText = data.psychology;
            document.getElementById('ttsScript').innerText = data.tts;

            // Badges
            document.getElementById('badgeList').innerHTML = data.badges.map(b => 
                `<span class="bg-indigo-600/20 text-indigo-400 px-3 py-1 rounded-full text-[10px] font-black uppercase">${b}</span>`
            ).join('');

            // Keywords
            document.getElementById('keywordCloud').innerHTML = data.seo.keywords.map(k => 
                `<span class="bg-slate-800 text-slate-400 px-3 py-1.5 rounded-xl text-xs font-bold border border-slate-700">#${k}</span>`
            ).join('');

            // Colors
            document.getElementById('colorContainer').innerHTML = data.colors.map(c => 
                `<div class="h-10 w-10 rounded-xl shadow-lg border border-white/10" style="background:${c.hex}" title="${c.hex}"></div>`
            ).join('');

            // Copy
            document.getElementById('copySuggestions').innerHTML = data.pnl.map(p => `
                <div class="p-6 bg-slate-800/40 border border-slate-700 rounded-3xl">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-[9px] font-black uppercase text-indigo-400">${p.type}</span>
                        <span class="text-[9px] font-black text-slate-500">Impatto: ${p.impact}</span>
                    </div>
                    <p class="text-sm font-medium text-white italic">"${p.text}"</p>
                </div>
            `).join('');

            initRadar(data.radar);
        }

        function initRadar(scores) {
            if (radarChart) radarChart.destroy();
            const ctx = document.getElementById('radarChart').getContext('2d');
            radarChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: Object.keys(scores),
                    datasets: [{
                        data: Object.values(scores),
                        backgroundColor: 'rgba(99, 102, 241, 0.2)',
                        borderColor: '#6366f1',
                        borderWidth: 3,
                        pointBackgroundColor: '#fff'
                    }]
                },
                options: {
                    scales: { r: { grid: { color: '#334155' }, angleLines: { color: '#334155' }, ticks: { display: false }, pointLabels: { color: '#94a3b8', font: { weight: 'bold' } } } },
                    plugins: { legend: { display: false } }
                }
            });
        }

        function showTab(id) {
            ['seo', 'pnl', 'ai'].forEach(t => {
                document.getElementById(`content-${t}`).classList.add('hidden');
                document.getElementById(`tab-${t}`).classList.remove('tab-active');
            });
            document.getElementById(`content-${id}`).classList.remove('hidden');
            document.getElementById(`tab-${id}`).classList.add('tab-active');
        }

        document.getElementById('toggleMobile').onclick = () => {
            document.getElementById('imgFrame').classList.toggle('mobile-mode');
        };

        // TTS Function
        async function playPreview() {
            if (!currentAnalysis) return;
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: `DÃ¬ con tono professionale e persuasivo: ${currentAnalysis.tts}` }] }],
                        generationConfig: { 
                            responseModalities: ["AUDIO"],
                            speechConfig: { voiceConfig: { prebuiltVoiceConfig: { voiceName: "Puck" } } }
                        }
                    })
                });
                const result = await response.json();
                const pcmData = result.candidates[0].content.parts[0].inlineData.data;
                const audioBlob = pcmToWav(pcmData, 24000); // Helper per convertire L16 a WAV
                const audio = new Audio(URL.createObjectURL(audioBlob));
                audio.play();
            } catch (err) { alert("Audio non disponibile al momento."); }
        }

        // AI Generation with Imagen 4.0
        document.getElementById('generateBtn').onclick = async () => {
            const area = document.getElementById('generatedImageArea');
            area.classList.remove('hidden');
            document.getElementById('genLoading').classList.remove('hidden');
            document.getElementById('genResult').classList.add('hidden');

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/imagen-4.0-generate-001:predict?key=${apiKey}`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        instances: { prompt: currentAnalysis.gen_prompt },
                        parameters: { sampleCount: 1 }
                    })
                });
                const result = await response.json();
                const imageUrl = `data:image/png;base64,${result.predictions[0].bytesBase64Encoded}`;
                document.getElementById('genLoading').classList.add('hidden');
                document.getElementById('genResult').src = imageUrl;
                document.getElementById('genResult').classList.remove('hidden');
            } catch (err) { alert("Generazione immagine fallita."); }
        };

        // PCM to WAV Utility
        function pcmToWav(base64, sampleRate) {
            const buffer = Uint8Array.from(atob(base64), c => c.charCodeAt(0)).buffer;
            const view = new DataView(new ArrayBuffer(44 + buffer.byteLength));
            const writeString = (offset, string) => { for (let i = 0; i < string.length; i++) view.setUint8(offset + i, string.charCodeAt(i)); };
            writeString(0, 'RIFF'); view.setUint32(4, 32 + buffer.byteLength, true); writeString(8, 'WAVE');
            writeString(12, 'fmt '); view.setUint32(16, 16, true); view.setUint16(20, 1, true); view.setUint16(22, 1, true);
            view.setUint32(24, sampleRate, true); view.setUint32(28, sampleRate * 2, true); view.setUint16(32, 2, true);
            view.setUint16(34, 16, true); writeString(36, 'data'); view.setUint32(40, buffer.byteLength, true);
            new Uint8Array(view.buffer, 44).set(new Uint8Array(buffer));
            return new Blob([view.buffer], { type: 'audio/wav' });
        }
    </script>
</body>
</html>
