<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Creative Evolution Pro - SEO & PNL Audit</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap');
        
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #f1f5f9; color: #0f172a; }
        .glass { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.3); }
        .card-shadow { box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.05), 0 8px 10px -6px rgba(0, 0, 0, 0.05); }
        
        .loader { border: 3px solid #e2e8f0; border-top: 3px solid #6366f1; border-radius: 50%; width: 40px; height: 40px; animation: spin 0.8s cubic-bezier(0.68, -0.55, 0.27, 1.55) infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        .heatmap-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; mix-blend-mode: overlay; opacity: 0; transition: opacity 0.4s ease; filter: blur(18px); }
        .show-heatmap { opacity: 0.8; }
        
        .status-badge { font-size: 0.6rem; font-weight: 800; padding: 2px 8px; border-radius: 4px; text-transform: uppercase; }
        
        .tab-btn.active { border-bottom: 2px solid #6366f1; color: #6366f1; }
    </style>
</head>
<body class="antialiased">

    <!-- Navbar -->
    <nav class="sticky top-0 z-50 glass border-b border-slate-200 px-6 py-4">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-2">
                <div class="bg-indigo-600 p-2 rounded-lg text-white">
                    <i class="fas fa-brain"></i>
                </div>
                <h1 class="font-black text-xl tracking-tighter uppercase italic">Creative<span class="text-indigo-600">Evolution</span></h1>
            </div>
            <div id="nav-actions" class="hidden flex items-center gap-4">
                <button onclick="resetApp()" class="text-xs font-bold uppercase text-slate-400 hover:text-indigo-600 transition">
                    <i class="fas fa-undo mr-1"></i> Reset
                </button>
                <button onclick="window.print()" class="bg-slate-900 text-white px-4 py-2 rounded-lg text-[10px] font-black uppercase tracking-widest shadow-lg shadow-indigo-200">
                    <i class="fas fa-file-pdf mr-2"></i> Report
                </button>
            </div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto p-6 md:p-10">
        
        <!-- Upload Section -->
        <div id="upload-view" class="max-w-2xl mx-auto mt-12 text-center animate-in fade-in slide-in-from-bottom-4 duration-700">
            <div class="mb-10">
                <h2 class="text-4xl font-black text-slate-900 mb-4 leading-tight">Ottimizza i tuoi asset per <span class="text-indigo-600 underline">Conversioni Reali</span>.</h2>
                <p class="text-slate-500 text-lg">Analisi istantanea basata su PNL, Principi di Cialdini e parametri SEO di Google.</p>
            </div>
            
            <div id="dropZone" class="glass card-shadow p-16 border-2 border-dashed border-slate-300 rounded-[3rem] cursor-pointer hover:border-indigo-400 hover:bg-white transition-all group relative overflow-hidden">
                <div class="relative z-10 flex flex-col items-center">
                    <div class="w-20 h-20 bg-indigo-50 text-indigo-500 rounded-3xl flex items-center justify-center mb-6 group-hover:rotate-12 transition-transform">
                        <i class="fas fa-upload text-3xl"></i>
                    </div>
                    <p class="text-xl font-bold text-slate-700">Rilascia l'immagine qui</p>
                    <p class="text-sm text-slate-400 mt-2 font-medium italic">Supporta JPG, PNG, WebP (Max 5MB)</p>
                </div>
                <input type="file" id="fileInput" class="hidden" accept="image/*">
            </div>
        </div>

        <!-- Loading View -->
        <div id="loading-view" class="hidden flex flex-col items-center justify-center py-32 space-y-6">
            <div class="loader"></div>
            <div class="text-center">
                <h3 class="font-black uppercase tracking-[0.3em] text-slate-800">Analisi Bio-metrica in corso</h3>
                <p class="text-slate-400 text-sm mt-2">Mappatura punti di fissazione oculare e trigger PNL...</p>
            </div>
        </div>

        <!-- Analysis View -->
        <div id="analysis-view" class="hidden space-y-8 animate-in fade-in duration-500">
            
            <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
                
                <!-- Sidebar -->
                <div class="lg:col-span-4 space-y-6">
                    <!-- Preview Immagine -->
                    <div class="glass card-shadow p-4 rounded-3xl overflow-hidden">
                        <div class="flex justify-between items-center mb-4 px-2">
                            <span class="text-[10px] font-black uppercase text-slate-400 tracking-widest">Visual Feedback</span>
                            <div class="flex gap-2">
                                <button onclick="toggleHeatmap()" class="bg-indigo-100 text-indigo-600 p-2 rounded-lg hover:bg-indigo-600 hover:text-white transition" title="Toggle Heatmap">
                                    <i class="fas fa-fire-alt"></i>
                                </button>
                            </div>
                        </div>
                        <div class="relative rounded-2xl overflow-hidden bg-slate-100 aspect-square flex items-center justify-center border border-slate-100 shadow-inner" id="imgContainer">
                            <img id="previewImg" class="w-full h-full object-contain">
                            <canvas id="heatmapLayer" class="heatmap-overlay"></canvas>
                        </div>
                    </div>

                    <!-- Impact Score -->
                    <div class="bg-slate-900 rounded-[2.5rem] p-8 text-white relative overflow-hidden card-shadow">
                        <div class="relative z-10">
                            <div class="flex justify-between items-start">
                                <span class="text-[10px] font-black uppercase tracking-widest text-indigo-400">Impact Score</span>
                                <i class="fas fa-bolt text-indigo-400 animate-pulse"></i>
                            </div>
                            <div class="mt-4 flex items-end gap-2">
                                <span id="scoreValue" class="text-7xl font-black tracking-tighter">--</span>
                                <span class="text-xl font-bold opacity-30 mb-2">/100</span>
                            </div>
                            <p id="scoreLabel" class="mt-4 inline-block px-3 py-1 bg-white/10 rounded-full text-[10px] font-bold uppercase tracking-widest border border-white/10"></p>
                        </div>
                    </div>

                    <!-- Audit Pos/Neg -->
                    <div id="auditList" class="space-y-3"></div>
                </div>

                <!-- Main Content -->
                <div class="lg:col-span-8 space-y-6">
                    
                    <!-- Tabs UI -->
                    <div class="glass rounded-[2rem] p-8 card-shadow border-none">
                        <div class="flex gap-8 border-b border-slate-100 mb-8">
                            <button class="tab-btn active pb-4 text-xs font-black uppercase tracking-widest">Strategia & Copy</button>
                            <button class="tab-btn pb-4 text-xs font-black uppercase tracking-widest text-slate-400">SEO & WordPress</button>
                        </div>

                        <div id="tab-copy" class="space-y-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="copyOptions"></div>
                        </div>
                    </div>

                    <!-- WordPress & Technical Box -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-indigo-600 rounded-[2rem] p-8 text-white card-shadow">
                            <h4 class="text-[10px] font-black uppercase tracking-widest text-indigo-200 mb-6">Elementor Guide</h4>
                            <div id="elementorTips" class="space-y-4"></div>
                        </div>
                        <div class="bg-white rounded-[2rem] p-8 card-shadow border border-slate-100">
                            <h4 class="text-[10px] font-black uppercase tracking-widest text-slate-400 mb-6">SEO Metadata</h4>
                            <div class="space-y-4">
                                <div>
                                    <label class="text-[9px] font-black text-slate-400 uppercase">Alt Text Suggerito (SEO)</label>
                                    <div id="altText" class="mt-1 p-3 bg-slate-50 rounded-xl text-xs font-medium text-slate-600 border border-slate-100 italic"></div>
                                </div>
                                <div id="seoKeywords" class="flex flex-wrap gap-2"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Radar Analysis -->
                    <div class="glass rounded-[2rem] p-8 card-shadow border-none flex flex-col md:flex-row items-center gap-10">
                        <div class="w-full md:w-1/2">
                            <h4 class="text-xl font-black mb-4">Analisi Dimensionale</h4>
                            <p class="text-sm text-slate-500 mb-6">Questo grafico mostra il bilanciamento tra l'estetica pura e l'efficacia comunicativa del tuo asset.</p>
                            <div id="radarLegend" class="grid grid-cols-2 gap-2"></div>
                        </div>
                        <div class="w-64 h-64">
                            <canvas id="radarChart"></canvas>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </main>

    <script>
        const apiKey = "";
        const fileInput = document.getElementById('fileInput');
        const dropZone = document.getElementById('dropZone');
        const uploadView = document.getElementById('upload-view');
        const loadingView = document.getElementById('loading-view');
        const analysisView = document.getElementById('analysis-view');
        const previewImg = document.getElementById('previewImg');
        const navActions = document.getElementById('nav-actions');
        
        let radarChart = null;

        // Gestione Caricamento
        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) handleFile(e.target.files[0]);
        });

        dropZone.addEventListener('click', () => fileInput.click());
        
        dropZone.addEventListener('dragover', (e) => { e.preventDefault(); dropZone.classList.add('scale-[0.98]', 'border-indigo-500'); });
        dropZone.addEventListener('dragleave', () => { dropZone.classList.remove('scale-[0.98]', 'border-indigo-500'); });
        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('scale-[0.98]', 'border-indigo-500');
            if (e.dataTransfer.files.length > 0) handleFile(e.dataTransfer.files[0]);
        });

        function handleFile(file) {
            if (!file || !file.type.startsWith('image/')) return;
            
            const reader = new FileReader();
            reader.onload = (e) => {
                previewImg.src = e.target.result;
                runAnalysis(e.target.result);
            };
            reader.readAsDataURL(file);
        }

        function resetApp() {
            fileInput.value = ""; // Fix Reset
            analysisView.classList.add('hidden');
            navActions.classList.add('hidden');
            uploadView.classList.remove('hidden');
        }

        async function runAnalysis(base64) {
            uploadView.classList.add('hidden');
            loadingView.classList.remove('hidden');

            const systemPrompt = `Sei un esperto di Neuromarketing, PNL, SEO Specialist e Web Designer esperto di WordPress/Elementor.
            Analizza l'immagine e restituisci un JSON con questa struttura esatta:
            {
                "score": 88,
                "label": "Ottimizzato",
                "scores": {"SEO": 85, "PNL": 75, "UX": 90, "Visual": 80, "Conversione": 70},
                "audit": {
                    "positivi": [{"titolo": "Gerarchia Visiva", "desc": "Il focus è chiaro sulla CTA."}],
                    "negativi": [{"titolo": "Contrasto Testo", "desc": "Il testo in basso è poco leggibile."}]
                },
                "copy_options": [
                    {"type": "Pattern Interrupt", "text": "Testo d'impatto...", "impact": "+35%"},
                    {"type": "Rapport PNL", "text": "Testo empatico...", "impact": "+20%"}
                ],
                "seo_data": {
                    "alt_text": "Descrizione ottimizzata per Google...",
                    "keywords": ["tag1", "tag2"]
                },
                "elementor_tips": ["Usa il widget CTA", "Applica un Box Shadow"],
                "heatmap_points": [{"x": 0.5, "y": 0.4, "v": 0.8}]
            }`;

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        contents: [{
                            parts: [
                                {text: "Esegui un audit professionale di questo asset creativo per una strategia di digital marketing."},
                                {inlineData: {mimeType: "image/png", data: base64.split(',')[1]}}
                            ]
                        }],
                        systemInstruction: { parts: [{ text: systemPrompt }] },
                        generationConfig: { responseMimeType: "application/json" }
                    })
                });

                const result = await response.json();
                const analysis = JSON.parse(result.candidates[0].content.parts[0].text);
                renderResults(analysis);
            } catch (err) {
                console.error("Analisi fallita:", err);
                resetApp();
            }
        }

        function renderResults(data) {
            loadingView.classList.add('hidden');
            analysisView.classList.remove('hidden');
            navActions.classList.remove('hidden');

            document.getElementById('scoreValue').innerText = data.score;
            document.getElementById('scoreLabel').innerText = data.label;

            // Audit
            const auditContainer = document.getElementById('auditList');
            auditContainer.innerHTML = '';
            data.audit.positivi.forEach(i => {
                auditContainer.innerHTML += `<div class="p-4 bg-emerald-50 border-l-4 border-emerald-500 rounded-xl text-emerald-900"><p class="text-[10px] font-black uppercase mb-1">PRO</p><p class="text-xs font-semibold">${i.titolo}: <span class="font-normal">${i.desc}</span></p></div>`;
            });
            data.audit.negativi.forEach(i => {
                auditContainer.innerHTML += `<div class="p-4 bg-rose-50 border-l-4 border-rose-500 rounded-xl text-rose-900"><p class="text-[10px] font-black uppercase mb-1">FIX</p><p class="text-xs font-semibold">${i.titolo}: <span class="font-normal">${i.desc}</span></p></div>`;
            });

            // Copy
            document.getElementById('copyOptions').innerHTML = data.copy_options.map(opt => `
                <div class="p-6 bg-slate-50 border border-slate-100 rounded-2xl group hover:bg-white transition-all shadow-sm">
                    <div class="flex justify-between items-center mb-4">
                        <span class="status-badge bg-indigo-600 text-white">${opt.type}</span>
                        <span class="text-[10px] font-black text-emerald-600">${opt.impact}</span>
                    </div>
                    <p class="text-sm font-medium italic text-slate-700">"${opt.text}"</p>
                </div>
            `).join('');

            // SEO & Technical
            document.getElementById('altText').innerText = data.seo_data.alt_text;
            document.getElementById('seoKeywords').innerHTML = data.seo_data.keywords.map(k => `<span class="bg-slate-100 text-slate-500 px-2 py-1 rounded-md text-[9px] font-bold uppercase tracking-tighter">#${k}</span>`).join('');
            
            document.getElementById('elementorTips').innerHTML = data.elementor_tips.map(tip => `
                <div class="flex items-center gap-3 text-xs font-medium">
                    <div class="h-2 w-2 rounded-full bg-white opacity-40"></div>
                    ${tip}
                </div>
            `).join('');

            initRadar(data.scores);
            drawHeatmap(data.heatmap_points);
        }

        function initRadar(scores) {
            if (radarChart) radarChart.destroy();
            const ctx = document.getElementById('radarChart').getContext('2d');
            radarChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: Object.keys(scores),
                    datasets: [{
                        data: Object.values(scores),
                        backgroundColor: 'rgba(99, 102, 241, 0.2)',
                        borderColor: '#6366f1',
                        borderWidth: 3,
                        pointBackgroundColor: '#fff',
                        pointBorderColor: '#6366f1',
                        pointRadius: 4
                    }]
                },
                options: {
                    scales: { r: { min: 0, max: 100, ticks: { display: false }, grid: { color: 'rgba(0,0,0,0.05)' }, angleLines: { display: false }, pointLabels: { font: { size: 10, weight: 'bold' } } } },
                    plugins: { legend: { display: false } }
                }
            });
        }

        function drawHeatmap(points) {
            const canvas = document.getElementById('heatmapLayer');
            const container = document.getElementById('imgContainer');
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0,0, canvas.width, canvas.height);

            points.forEach(p => {
                const grad = ctx.createRadialGradient(p.x * canvas.width, p.y * canvas.height, 0, p.x * canvas.width, p.y * canvas.height, 120);
                grad.addColorStop(0, `rgba(255, 60, 0, ${p.v})`);
                grad.addColorStop(0.5, 'rgba(255, 200, 0, 0.2)');
                grad.addColorStop(1, 'transparent');
                ctx.fillStyle = grad;
                ctx.fillRect(0,0, canvas.width, canvas.height);
            });
        }

        function toggleHeatmap() {
            document.getElementById('heatmapLayer').classList.toggle('show-heatmap');
        }
    </script>
</body>
</html>
