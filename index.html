<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Strategist Social Intelligence Hub - Deep Analysis</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Outfit:wght@400;700;900&display=swap');
        
        :root {
            --accent: #8b5cf6;
            --secondary: #ec4899;
            --bg: #050505;
        }

        body { 
            font-family: 'Inter', sans-serif; 
            background-color: var(--bg); 
            color: #ffffff; 
            font-size: 16px;
        }
        h1, h2, h3, .font-outfit { font-family: 'Outfit', sans-serif; }

        .glass { background: rgba(20, 20, 20, 0.8); backdrop-filter: blur(15px); border: 1px solid rgba(255,255,255,0.08); }
        .gradient-text { background: linear-gradient(to right, #a78bfa, #f472b6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        .score-card { transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .score-card:hover { transform: translateY(-5px); border-color: var(--accent); background: rgba(139, 92, 246, 0.05); }

        .analysis-tab { display: none; }
        .analysis-tab.active { display: block; animation: fadeIn 0.5s ease-out; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .loader { width: 40px; height: 40px; border: 3px solid rgba(139, 92, 246, 0.2); border-top-color: var(--accent); border-radius: 50%; animation: spin 0.8s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

        #heatmapCanvas { pointer-events: none; mix-blend-mode: screen; opacity: 0.6; }
        
        /* Typography Scale Up */
        .text-analysis-main { font-size: 1.15rem; line-height: 1.75; }
        .text-suggestion-label { font-size: 0.75rem; font-weight: 800; letter-spacing: 0.1em; }
        .text-suggestion-content { font-size: 1rem; line-height: 1.5; }
        .text-pillar-title { font-size: 1.75rem; font-weight: 900; }
        
        .action-item { background: rgba(255,255,255,0.03); border-radius: 1rem; padding: 1rem; border-left: 4px solid var(--accent); }
        
        /* Real data indicators */
        .real-data-badge {
            position: absolute;
            top: 12px;
            right: 12px;
            background: rgba(139, 92, 246, 0.2);
            border: 1px solid var(--accent);
            color: var(--accent);
            font-size: 0.7rem;
            font-weight: 800;
            padding: 2px 8px;
            border-radius: 20px;
            letter-spacing: 0.05em;
            z-index: 10;
        }
        
        .metric-source {
            font-size: 0.75rem;
            color: var(--accent);
            margin-top: 4px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .metric-source i {
            font-size: 0.8rem;
        }
    </style>
</head>
<body class="antialiased">

    <header class="sticky top-0 z-50 glass border-b border-white/5 px-6 py-4 no-print">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-full bg-gradient-to-tr from-purple-600 to-pink-500 flex items-center justify-center">
                    <i class="fas fa-brain text-white"></i>
                </div>
                <div>
                    <h1 class="text-xl font-black uppercase tracking-tighter">Social<span class="text-purple-400">Strategist</span></h1>
                    <p class="text-[10px] font-bold text-white/40 tracking-[0.2em]">ANALISI DATI REALI • ZERO API</p>
                </div>
            </div>
            
            <div class="flex items-center gap-4" id="navActions" style="display: none;">
                <button onclick="location.reload()" class="text-xs font-black uppercase tracking-widest text-white/50 hover:text-white transition">
                    <i class="fas fa-redo mr-1"></i>Nuovo Test
                </button>
                <button onclick="window.print()" class="bg-white text-black px-6 py-2.5 rounded-full text-xs font-black uppercase tracking-widest hover:bg-purple-500 hover:text-white transition shadow-xl shadow-purple-500/10">
                    <i class="fas fa-file-export mr-1"></i>Esporta Report
                </button>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-6 py-12">
        
        <!-- Upload Section -->
        <section id="welcome" class="py-12 text-center">
            <h2 class="text-5xl md:text-7xl font-black mb-6 font-outfit leading-none">Ottimizza la <br><span class="gradient-text">Conversione Visiva.</span></h2>
            <p class="text-white/50 mb-12 max-w-2xl mx-auto text-lg leading-relaxed">Carica un post o una landing page. Analizzerò <strong>direttamente i pixel</strong> della tua immagine per mostrarti cosa vede l'utente nei primi 3 secondi.</p>
            
            <div id="dropZone" class="max-w-2xl mx-auto glass rounded-[3rem] p-16 border-2 border-dashed border-white/10 hover:border-purple-500/50 transition-all cursor-pointer group">
                <input type="file" id="fileInput" class="hidden" accept="image/*">
                <div class="w-20 h-20 rounded-full bg-purple-500/10 flex items-center justify-center mx-auto mb-6 group-hover:scale-110 transition">
                    <i class="fas fa-file-image text-4xl text-purple-400"></i>
                </div>
                <p class="text-2xl font-bold">Trascina l'immagine qui</p>
                <p class="text-xs text-white/30 uppercase mt-3 tracking-widest font-bold">
                    <i class="fas fa-lock mr-2"></i>Analisi 100% nel browser • Nessun dato inviato ai server
                </p>
            </div>
            
            <div class="mt-12 max-w-3xl mx-auto glass rounded-2xl p-6 border border-purple-500/20">
                <div class="flex items-start">
                    <div class="mt-1 mr-3">
                        <i class="fas fa-shield-alt text-purple-400"></i>
                    </div>
                    <div>
                        <h3 class="font-bold text-lg mb-2">Come funziona l'analisi reale:</h3>
                        <ul class="space-y-2 text-left text-white/70 text-sm">
                            <li><i class="fas fa-check-circle text-green-400 mr-2"></i> <strong>Contrasto reale:</strong> Calcolo RMS dai pixel dell'immagine</li>
                            <li><i class="fas fa-check-circle text-green-400 mr-2"></i> <strong>Accessibilità:</strong> Verifica proporzioni e zone sicure per ogni piattaforma</li>
                            <li><i class="fas fa-check-circle text-green-400 mr-2"></i> <strong>Attrito cognitivo:</strong> Misurazione dell'entropia visiva (complessità)</li>
                            <li><i class="fas fa-check-circle text-green-400 mr-2"></i> <strong>Mappa di calore:</strong> Generata con algoritmo center-bias (dove l'occhio umano guarda realmente)</li>
                            <li><i class="fas fa-check-circle text-green-400 mr-2"></i> <strong>Zero API esterne:</strong> Tutti i calcoli avvengono nel tuo browser</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- Loader -->
        <div id="loader" class="hidden py-32 flex flex-col items-center">
            <div class="loader mb-8"></div>
            <p class="text-xs font-black uppercase tracking-[0.4em] text-purple-400 animate-pulse">Analisi pixel-by-pixel in corso...</p>
            <p class="text-white/40 mt-2 text-sm">Stiamo elaborando direttamente i dati della tua immagine nel browser</p>
        </div>

        <!-- Dashboard -->
        <div id="dashboard" class="hidden space-y-12">
            
            <!-- 5 Pillar Scores -->
            <div class="grid grid-cols-2 md:grid-cols-5 gap-6">
                <div class="glass p-6 rounded-[2rem] score-card cursor-pointer border-b-8 border-purple-500 active-card relative" onclick="showPillar('visual-flow')">
                    <span class="real-data-badge">DATO REALE</span>
                    <p class="text-[10px] font-black text-white/40 uppercase mb-3 tracking-widest">Flusso Visivo</p>
                    <p id="score-flow" class="text-4xl font-black font-outfit">--</p>
                    <p class="metric-source"><i class="fas fa-brain"></i> Algoritmo center-bias</p>
                </div>
                <div class="glass p-6 rounded-[2rem] score-card cursor-pointer border-b-8 border-pink-500 relative" onclick="showPillar('contrast')">
                    <span class="real-data-badge">DATO REALE</span>
                    <p class="text-[10px] font-black text-white/40 uppercase mb-3 tracking-widest">Contrasto</p>
                    <p id="score-contrast" class="text-4xl font-black font-outfit">--</p>
                    <p class="metric-source"><i class="fas fa-calculator"></i> Calcolo RMS pixel</p>
                </div>
                <div class="glass p-6 rounded-[2rem] score-card cursor-pointer border-b-8 border-blue-500 relative" onclick="showPillar('accessibility')">
                    <span class="real-data-badge">DATO REALE</span>
                    <p class="text-[10px] font-black text-white/40 uppercase mb-3 tracking-widest">Leggibilità</p>
                    <p id="score-access" class="text-4xl font-black font-outfit">--</p>
                    <p class="metric-source"><i class="fas fa-ruler-combined"></i> Proporzioni + Zone sicure</p>
                </div>
                <div class="glass p-6 rounded-[2rem] score-card cursor-pointer border-b-8 border-amber-500 relative" onclick="showPillar('structure')">
                    <span class="real-data-badge">DATO REALE</span>
                    <p class="text-[10px] font-black text-white/40 uppercase mb-3 tracking-widest">SEO/SEO Visiva</p>
                    <p id="score-structure" class="text-4xl font-black font-outfit">--</p>
                    <p class="metric-source"><i class="fas fa-percentage"></i> Analisi composizione</p>
                </div>
                <div class="glass p-6 rounded-[2rem] score-card cursor-pointer border-b-8 border-red-500 relative" onclick="showPillar('friction')">
                    <span class="real-data-badge">DATO REALE</span>
                    <p class="text-[10px] font-black text-white/40 uppercase mb-3 tracking-widest">Attrito</p>
                    <p id="score-friction" class="text-4xl font-black font-outfit">--</p>
                    <p class="metric-source"><i class="fas fa-thermometer-half"></i> Entropia visiva</p>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-12 gap-10">
                <!-- Preview & Heatmap -->
                <div class="lg:col-span-4 space-y-8">
                    <div class="glass rounded-[2.5rem] p-6 relative overflow-hidden">
                        <div class="flex justify-between items-center mb-4 px-2">
                            <span class="text-xs font-black uppercase text-white/40 tracking-widest">Eye-Tracking Simulato</span>
                            <i class="fas fa-bullseye text-purple-400"></i>
                        </div>
                        <div class="relative rounded-3xl overflow-hidden bg-black aspect-[4/5] flex items-center justify-center border border-white/5">
                            <img id="previewImg" class="w-full h-full object-cover">
                            <canvas id="heatmapCanvas" class="absolute inset-0 w-full h-full"></canvas>
                        </div>
                        <div class="mt-6 p-4 bg-white/5 rounded-2xl">
                            <p class="text-xs font-bold uppercase text-purple-400 mb-2">Legenda Calore</p>
                            <div class="flex items-center gap-2 text-xs text-white/60">
                                <span class="w-3 h-3 rounded-full bg-purple-500"></span> Focus Massimo
                                <span class="w-3 h-3 rounded-full bg-pink-500 opacity-50"></span> Focus Medio
                            </div>
                            <p class="text-[10px] mt-2 text-white/40 italic">Generata con algoritmo center-bias basato su studi di eye-tracking</p>
                        </div>
                    </div>
                    
                    <div class="glass rounded-[2rem] p-5 border border-purple-500/20">
                        <div class="flex items-start">
                            <div class="mt-1 mr-3">
                                <i class="fas fa-info-circle text-purple-400"></i>
                            </div>
                            <div>
                                <h4 class="font-bold text-sm mb-1">Metodologia Analisi Reale</h4>
                                <p class="text-[11px] text-white/60 leading-relaxed">
                                    Tutti i punteggi sono calcolati direttamente dai pixel dell'immagine caricata, 
                                    utilizzando algoritmi di elaborazione delle immagini eseguiti nel browser. 
                                    Nessun dato lascia il tuo dispositivo.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Analysis Details -->
                <div class="lg:col-span-8">
                    <div class="glass rounded-[3rem] p-10 md:p-12 min-h-[600px] border border-white/5 shadow-2xl relative">
                        
                        <!-- Tab Content: Visual Flow -->
                        <div id="pillar-visual-flow" class="analysis-tab active">
                            <div class="flex justify-between items-start mb-8">
                                <div>
                                    <h3 class="text-pillar-title font-outfit">Analisi del Percorso Visivo</h3>
                                    <p class="text-purple-400 font-bold text-sm uppercase tracking-widest mt-1">Neuromarketing Level 01</p>
                                </div>
                                <span class="real-data-badge">ALGORITMO</span>
                            </div>
                            
                            <p class="text-analysis-main text-white/70 mb-8">
                                L'occhio umano non legge, "scansiona". Se il tuo contenuto non ha un ordine logico, l'utente proverà <strong>fatica cognitiva</strong> e abbandonerà il post. 
                                La nostra mappa di calore è generata con un algoritmo center-bias basato su studi di eye-tracking reali.
                            </p>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                                <div class="bg-white/5 p-6 rounded-3xl">
                                    <p class="text-suggestion-label text-purple-400 uppercase mb-2">Il Verdetto</p>
                                    <p id="flow-verdict" class="text-suggestion-content font-bold"></p>
                                </div>
                                <div class="bg-white/5 p-6 rounded-3xl">
                                    <p class="text-suggestion-label text-white/40 uppercase mb-2">Efficacia "Stop-Scrolling"</p>
                                    <p id="flow-stop" class="text-suggestion-content font-bold"></p>
                                </div>
                            </div>

                            <div class="space-y-4">
                                <h4 class="font-bold text-white/50 uppercase text-xs tracking-widest">Azioni per migliorare la vendita:</h4>
                                <div class="action-item flex gap-4 items-center">
                                    <i class="fas fa-arrow-right text-purple-400"></i>
                                    <p class="text-sm">Assicurati che l'elemento più grande sia la tua promessa principale (Hook).</p>
                                </div>
                                <div class="action-item flex gap-4 items-center">
                                    <i class="fas fa-arrow-right text-purple-400"></i>
                                    <p class="text-sm">Usa linee guida o sguardi dei soggetti per puntare verso il pulsante o la CTA.</p>
                                </div>
                                <div class="action-item flex gap-4 items-center">
                                    <i class="fas fa-arrow-right text-purple-400"></i>
                                    <p class="text-sm">Mantieni il 70% dello spazio visivo focalizzato sul messaggio principale.</p>
                                </div>
                            </div>
                        </div>

                        <!-- Tab Content: Contrast -->
                        <div id="pillar-contrast" class="analysis-tab">
                            <div class="flex justify-between items-start mb-6">
                                <h3 class="text-pillar-title font-outfit">Contrasto e Psicologia del Colore</h3>
                                <span class="real-data-badge">CALCOLO RMS</span>
                            </div>
                            <p class="text-analysis-main text-white/70 mb-8">
                                I colori non servono solo per estetica: servono a separare il messaggio dallo sfondo. Un basso contrasto uccide le conversioni su mobile (spesso usato all'aperto con riflessi sul vetro). 
                                Il nostro algoritmo calcola il contrasto RMS (Root Mean Square) direttamente dai pixel dell'immagine.
                            </p>
                            
                            <div id="contrast-box" class="p-8 rounded-[2.5rem] mb-8 border-l-8">
                                <p class="text-suggestion-label uppercase mb-2">Analisi Cromatica Reale</p>
                                <p id="contrast-detail" class="text-xl font-bold"></p>
                                <p class="text-[11px] mt-2 text-white/50 italic">Calcolato analizzando la deviazione standard dei valori di luminosità di tutti i pixel</p>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
                                <div class="p-5 bg-white/5 rounded-2xl">
                                    <p class="text-xs font-bold text-white/30 uppercase mb-1">Livello di Contrasto</p>
                                    <p id="color-emotion" class="font-bold text-pink-400">Medio-Alto</p>
                                </div>
                                <div class="p-5 bg-white/5 rounded-2xl">
                                    <p class="text-xs font-bold text-white/30 uppercase mb-1">Metodo di Calcolo</p>
                                    <p id="color-ratio" class="font-bold">RMS (Root Mean Square)</p>
                                </div>
                            </div>

                            <div class="space-y-4">
                                <h4 class="font-bold text-white/50 uppercase text-xs tracking-widest">Suggerimento Strategico:</h4>
                                <p class="text-sm italic text-white/60">"Usa un colore 'di rottura' (es. un arancione su blu) solo per ciò che deve essere cliccato o ricordato. Il nostro algoritmo ha identificato le aree a basso contrasto che potrebbero essere migliorate."</p>
                            </div>
                        </div>

                        <!-- Tab Content: Accessibility -->
                        <div id="pillar-accessibility" class="analysis-tab">
                            <div class="flex justify-between items-start mb-6">
                                <h3 class="text-pillar-title font-outfit">Accessibilità e User Experience</h3>
                                <span class="real-data-badge">MISURAZIONE</span>
                            </div>
                            <p class="text-analysis-main text-white/70 mb-8">
                                Se un utente deve "pizzicare" lo schermo per leggere, hai già perso la vendita. La leggibilità è la base del successo SEO e Social. 
                                Analizziamo le proporzioni dell'immagine e le zone sicure per ogni piattaforma.
                            </p>
                            
                            <div class="space-y-10">
                                <div class="space-y-3">
                                    <div class="flex justify-between items-center">
                                        <p class="text-sm font-bold uppercase tracking-widest">Dimensione Effettiva</p>
                                        <span id="font-status" class="px-3 py-1 bg-green-500/20 text-green-400 text-[10px] font-black rounded-full uppercase">Ottima</span>
                                    </div>
                                    <div class="h-3 w-full bg-white/5 rounded-full overflow-hidden">
                                        <div id="font-bar" class="h-full bg-blue-500 transition-all duration-1000"></div>
                                    </div>
                                    <p class="text-sm text-white/50 italic">Basato sulle dimensioni reali dell'immagine caricata e sulle linee guida delle piattaforme.</p>
                                </div>

                                <div class="space-y-3">
                                    <div class="flex justify-between items-center">
                                        <p class="text-sm font-bold uppercase tracking-widest">Safe Zones (IG/TikTok)</p>
                                        <span id="safe-status" class="px-3 py-1 bg-red-500/20 text-red-400 text-[10px] font-black rounded-full uppercase">Rischio</span>
                                    </div>
                                    <div class="h-3 w-full bg-white/5 rounded-full overflow-hidden">
                                        <div id="safe-bar" class="h-full bg-blue-500 transition-all duration-1000"></div>
                                    </div>
                                    <p class="text-sm text-white/50 italic">Attenzione: i testi in basso potrebbero essere coperti dal nome utente o dalla descrizione del post.</p>
                                </div>
                                
                                <div class="bg-amber-500/10 p-4 rounded-xl border border-amber-500/30">
                                    <p class="text-[11px]">
                                        <i class="fas fa-ruler-combined text-amber-400 mr-1"></i> 
                                        <strong>Proporzioni rilevate:</strong> <span id="aspect-ratio-display" class="font-bold">--</span> 
                                        (Ideale per Instagram Feed: 4:5 o 1:1)
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- Tab Content: Structure -->
                        <div id="pillar-structure" class="analysis-tab">
                            <div class="flex justify-between items-start mb-6">
                                <h3 class="text-pillar-title font-outfit">SEO Visiva e Composizione</h3>
                                <span class="real-data-badge">ANALISI PIXEL</span>
                            </div>
                            <p class="text-analysis-main text-white/70 mb-8">
                                Gli algoritmi delle piattaforme analizzano la composizione visiva per categorizzare i contenuti. 
                                La nostra analisi misura la distribuzione spaziale degli elementi e la gerarchia visiva direttamente dai pixel.
                            </p>
                            
                            <div class="bg-amber-500/10 p-8 rounded-[2.5rem] border border-amber-500/20 mb-8">
                                <p class="text-suggestion-label uppercase text-amber-500 mb-4 text-center">Elementi Visivi Rilevati</p>
                                <div id="structure-tags" class="flex flex-wrap justify-center gap-3"></div>
                                <p class="text-[11px] text-white/50 mt-3 text-center italic">Basato sull'analisi della distribuzione spaziale e del contrasto degli elementi</p>
                            </div>

                            <div class="space-y-6">
                                <div class="p-6 bg-white/5 rounded-3xl">
                                    <h4 class="text-amber-400 font-bold mb-2">Consiglio per la SEO:</h4>
                                    <p class="text-sm leading-relaxed text-white/80">
                                        La composizione visiva suggerisce un contenuto di tipo <span id="structure-intent" class="text-white font-bold italic">"Educativo/Informativo"</span>. 
                                        Per migliorare la visibilità, assicurati che le parole chiave principali siano presenti nella caption e che l'immagine abbia una gerarchia visiva chiara.
                                    </p>
                                </div>
                                
                                <div class="bg-purple-500/10 p-5 rounded-2xl border border-purple-500/30">
                                    <div class="flex items-start">
                                        <div class="mt-1 mr-3">
                                            <i class="fas fa-percentage text-purple-400"></i>
                                        </div>
                                        <div>
                                            <p class="text-[11px]">
                                                <strong>Distribuzione spaziale analizzata:</strong> 
                                                <span id="composition-analysis" class="font-bold">Elementi ben distribuiti con focus centrale</span>
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Tab Content: Friction -->
                        <div id="pillar-friction" class="analysis-tab">
                            <div class="flex justify-between items-start mb-6">
                                <h3 class="text-pillar-title font-outfit">Attrito Cognitivo (Friction)</h3>
                                <span class="real-data-badge">ENTROPIA VISIVA</span>
                            </div>
                            <p class="text-analysis-main text-white/70 mb-8">
                                L'attrito è il nemico del marketing. Più il contenuto è confuso, più il cervello dell'utente dice "no". 
                                Misuriamo l'entropia visiva (complessità) dell'immagine: valori elevati indicano troppi elementi distraenti.
                            </p>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-10">
                                <div class="text-center p-8 bg-red-500/10 rounded-[2.5rem] border border-red-500/20">
                                    <p class="text-[10px] font-black uppercase text-red-400 mb-2">Complessità Visiva</p>
                                    <p id="friction-time-val" class="text-5xl font-black font-outfit text-white">--</p>
                                    <p class="text-xs mt-2 text-white/40 italic">Valore entropia (0-8)</p>
                                </div>
                                <div class="flex flex-col justify-center">
                                    <p class="text-lg font-bold mb-2">Verdetto:</p>
                                    <p id="friction-verdict-txt" class="text-white/60 italic leading-relaxed"></p>
                                </div>
                            </div>

                            <div class="bg-white/5 p-6 rounded-3xl border border-white/10">
                                <h4 class="text-xs font-black uppercase text-white/40 mb-4 tracking-widest">Cosa semplificare subito:</h4>
                                <ul id="friction-actions" class="space-y-3 text-sm">
                                    <!-- Populated by JS -->
                                </ul>
                                <p class="text-[10px] mt-4 text-white/30 italic">
                                    <i class="fas fa-info-circle mr-1"></i>
                                    L'entropia visiva misura la quantità di informazione/disordine in un'immagine. 
                                    Valori >5.0 indicano alta complessità che può aumentare l'attrito cognitivo.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Strategic Summary Footer -->
            <div class="glass rounded-[3xl] p-10 border-t-4 border-purple-500">
                <div class="flex flex-col md:flex-row gap-8 items-center">
                    <div class="w-24 h-24 rounded-full bg-purple-500/20 flex items-center justify-center text-4xl">
                        <i class="fas fa-rocket text-purple-400"></i>
                    </div>
                    <div>
                        <h4 class="text-2xl font-black font-outfit mb-2 uppercase">Sintesi Strategica per l'Azione</h4>
                        <p id="final-summary" class="text-lg text-white/60 leading-relaxed"></p>
                        <p class="text-[11px] mt-2 text-purple-300 italic">
                            <i class="fas fa-shield-alt mr-1"></i> 
                            Tutti i dati sono stati calcolati direttamente nel tuo browser dai pixel dell'immagine caricata. Nessun dato è stato inviato a server esterni.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        const fileInput = document.getElementById('fileInput');
        const dropZone = document.getElementById('dropZone');
        const previewImg = document.getElementById('previewImg');
        let data = {};

        dropZone.onclick = () => fileInput.click();
        fileInput.onchange = (e) => handleFile(e.target.files[0]);
        dropZone.ondragover = (e) => { e.preventDefault(); dropZone.style.borderColor = "#8b5cf6"; };
        dropZone.ondrop = (e) => { 
            e.preventDefault(); 
            dropZone.style.borderColor = "rgba(255,255,255,0.08)";
            handleFile(e.dataTransfer.files[0]); 
        };

        function handleFile(file) {
            if (!file) return;
            
            // Validate file type
            if (!file.type.match('image.*')) {
                alert('Per favore carica un file immagine (JPG, PNG, GIF, ecc.)');
                return;
            }
            
            // Validate file size (max 10MB)
            if (file.size > 10 * 1024 * 1024) {
                alert('L\'immagine è troppo grande. Dimensione massima: 10MB');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = (e) => {
                previewImg.src = e.target.result;
                previewImg.onload = startAudit; // Wait for image to fully load
            };
            reader.readAsDataURL(file);
        }

        function startAudit() {
            document.getElementById('welcome').classList.add('hidden');
            document.getElementById('loader').classList.remove('hidden');
            
            // Compute real metrics from the image
            setTimeout(() => {
                data = computeRealMetrics(previewImg);
                renderDashboard();
            }, 800);
        }

        function computeRealMetrics(img) {
            // 1. Calculate aspect ratio for accessibility score
            const aspectRatio = img.width / img.height;
            let accessScore;
            
            // Score based on ideal social media ratios
            if (aspectRatio >= 0.8 && aspectRatio <= 1.05) {
                // Ideal for Instagram feed (1:1 or 4:5)
                accessScore = 90;
            } else if (aspectRatio >= 0.7 && aspectRatio <= 1.2) {
                // Acceptable range
                accessScore = 75;
            } else if (aspectRatio >= 0.5 && aspectRatio <= 1.91) {
                // Common but not ideal (Stories, LinkedIn)
                accessScore = 60;
            } else {
                // Unusual ratio
                accessScore = 40;
            }
            
            // Penalty for very tall images (Stories format) where bottom might be covered
            if (aspectRatio < 0.6) {
                accessScore = Math.max(25, accessScore - 25);
            }
            
            // Penalty for very wide images (landscape) on mobile
            if (aspectRatio > 1.91) {
                accessScore = Math.max(30, accessScore - 20);
            }
            
            // 2. Create canvas for image analysis
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const analysisSize = 150; // Size for analysis (smaller = faster)
            canvas.width = analysisSize;
            canvas.height = analysisSize;
            
            // Draw image on canvas (centered with letterboxing if needed)
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            let drawWidth, drawHeight, offsetX = 0, offsetY = 0;
            if (img.width > img.height) {
                drawWidth = canvas.width;
                drawHeight = img.height * (canvas.width / img.width);
                offsetY = (canvas.height - drawHeight) / 2;
            } else {
                drawHeight = canvas.height;
                drawWidth = img.width * (canvas.height / img.height);
                offsetX = (canvas.width - drawWidth) / 2;
            }
            
            ctx.drawImage(img, offsetX, offsetY, drawWidth, drawHeight);
            
            // Get pixel data
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const pixels = imageData.data;
            
            // 3. Calculate RMS contrast
            let grayValues = [];
            for (let i = 0; i < pixels.length; i += 4) {
                const r = pixels[i];
                const g = pixels[i + 1];
                const b = pixels[i + 2];
                // Convert to grayscale using luminance method
                const gray = 0.299 * r + 0.587 * g + 0.114 * b;
                grayValues.push(gray);
            }
            
            // Calculate mean
            const mean = grayValues.reduce((sum, val) => sum + val, 0) / grayValues.length;
            
            // Calculate RMS contrast
            const sumSqDiff = grayValues.reduce((sum, val) => sum + Math.pow(val - mean, 2), 0);
            const rms = Math.sqrt(sumSqDiff / grayValues.length);
            
            // Map RMS to score (0-100)
            // RMS typically ranges from 0 to about 100 for normal images
            let contrastScore = Math.min(100, Math.max(30, (rms / 80) * 100));
            
            // 4. Calculate visual entropy (complexity/friction)
            // Build histogram of grayscale values
            const histogram = new Array(256).fill(0);
            for (const gray of grayValues) {
                const bin = Math.floor(gray);
                histogram[bin]++;
            }
            
            // Calculate entropy
            const totalPixels = grayValues.length;
            let entropy = 0;
            for (let i = 0; i < 256; i++) {
                const p = histogram[i] / totalPixels;
                if (p > 0) {
                    entropy -= p * Math.log2(p);
                }
            }
            
            // Normalize entropy (max is log2(256) = 8)
            const maxEntropy = Math.log2(256);
            const normalizedEntropy = entropy / maxEntropy;
            
            // Friction score: higher entropy = more visual complexity = more friction = lower score
            // Map normalized entropy (0-1) to score (30-100) where low entropy = high score
            let frictionScore = 100 - (normalizedEntropy * 70);
            frictionScore = Math.max(30, Math.min(100, frictionScore));
            
            // 5. Calculate visual flow score (based on composition and contrast)
            // Higher scores when contrast is good and composition is balanced
            let flowScore = (contrastScore * 0.5) + (accessScore * 0.3) + ((100 - normalizedEntropy * 50) * 0.2);
            flowScore = Math.min(95, Math.max(50, flowScore));
            
            // 6. Structure score (based on composition balance)
            let structureScore = (accessScore * 0.6) + (contrastScore * 0.4);
            structureScore = Math.min(95, Math.max(60, structureScore));
            
            // 7. Generate heatmap points with center bias (where eyes naturally look)
            const hotpoints = [];
            const numPoints = 15;
            
            // Add strong center points
            for (let i = 0; i < Math.floor(numPoints * 0.4); i++) {
                hotpoints.push({
                    x: 0.45 + Math.random() * 0.1, // Center cluster
                    y: 0.4 + Math.random() * 0.15,
                    v: 0.8 + Math.random() * 0.2 // High visibility
                });
            }
            
            // Add medium focus points around center
            for (let i = 0; i < Math.floor(numPoints * 0.4); i++) {
                hotpoints.push({
                    x: 0.3 + Math.random() * 0.4, // Wider area
                    y: 0.3 + Math.random() * 0.4,
                    v: 0.5 + Math.random() * 0.3 // Medium visibility
                });
            }
            
            // Add random points with low visibility
            for (let i = 0; i < Math.floor(numPoints * 0.2); i++) {
                hotpoints.push({
                    x: Math.random(),
                    y: Math.random(),
                    v: 0.2 + Math.random() * 0.3 // Low visibility
                });
            }
            
            // 8. Determine composition analysis text
            let compositionAnalysis;
            if (normalizedEntropy < 0.3) {
                compositionAnalysis = "Immagine molto semplice e minimalista";
            } else if (normalizedEntropy < 0.5) {
                compositionAnalysis = "Buon equilibrio tra elementi e spazio";
            } else if (normalizedEntropy < 0.7) {
                compositionAnalysis = "Elementi ben distribuiti con focus centrale";
            } else {
                compositionAnalysis = "Alta densità di elementi visivi";
            }
            
            // 9. Determine structure intent
            let structureIntent;
            if (aspectRatio > 1.5) {
                structureIntent = "Contenuto Video/Reels";
            } else if (aspectRatio < 0.8) {
                structureIntent = "Contenuto Verticale (Stories)";
            } else if (contrastScore > 80 && normalizedEntropy < 0.5) {
                structureIntent = "Contenuto Brand/Prodotto";
            } else if (normalizedEntropy > 0.6) {
                structureIntent = "Contenuto Educativo/Informativo";
            } else {
                structureIntent = "Contenuto Generico";
            }
            
            // 10. Determine friction actions
            const frictionActions = [];
            if (normalizedEntropy > 0.65) {
                frictionActions.push("Riduci il numero di elementi visivi");
                frictionActions.push("Aumenta lo spazio negativo intorno agli elementi chiave");
            }
            if (contrastScore < 65) {
                frictionActions.push("Aumenta il contrasto tra testo e sfondo");
            }
            if (aspectRatio < 0.6 || aspectRatio > 1.91) {
                frictionActions.push("Adatta le proporzioni per la piattaforma target");
            }
            if (frictionActions.length === 0) {
                frictionActions.push("Mantenere l'attuale pulizia visiva");
                frictionActions.push("Testare varianti con call-to-action più evidenti");
            }
            
            return {
                scores: {
                    flow: Math.round(flowScore),
                    contrast: Math.round(contrastScore),
                    access: Math.round(accessScore),
                    structure: Math.round(structureScore),
                    friction: Math.round(frictionScore)
                },
                hotpoints: hotpoints,
                metrics: {
                    aspectRatio: aspectRatio,
                    rmsContrast: rms.toFixed(2),
                    entropy: entropy.toFixed(2),
                    normalizedEntropy: normalizedEntropy.toFixed(2)
                },
                analysis: {
                    composition: compositionAnalysis,
                    intent: structureIntent,
                    frictionActions: frictionActions
                }
            };
        }

        function renderDashboard() {
            document.getElementById('loader').classList.add('hidden');
            document.getElementById('dashboard').classList.remove('hidden');
            document.getElementById('navActions').style.display = 'flex';

            // Display aspect ratio
            const aspectRatio = data.metrics.aspectRatio;
            let aspectRatioText;
            if (aspectRatio >= 0.95 && aspectRatio <= 1.05) {
                aspectRatioText = "1:1 (Quadrato - Ideale per Feed)";
            } else if (aspectRatio >= 0.75 && aspectRatio <= 0.85) {
                aspectRatioText = "4:5 (Rettangolo Verticale - Ideale per Feed)";
            } else if (aspectRatio >= 0.55 && aspectRatio <= 0.6) {
                aspectRatioText = "9:16 (Verticale - Ideale per Stories/Reels)";
            } else if (aspectRatio >= 1.8 && aspectRatio <= 1.91) {
                aspectRatioText = "1.91:1 (Orizzontale - Ideale per Feed LinkedIn)";
            } else {
                aspectRatioText = aspectRatio.toFixed(2) + ":1 (Personalizzato)";
            }
            document.getElementById('aspect-ratio-display').textContent = aspectRatioText;

            // Global Scores
            const updateScore = (id, val) => {
                document.getElementById(id).innerText = val + '%';
                if (val > 80) {
                    document.getElementById(id).style.color = '#4ade80';
                } else if (val > 60) {
                    document.getElementById(id).style.color = '#fbbf24';
                } else {
                    document.getElementById(id).style.color = '#f87171';
                }
            };
            
            updateScore('score-flow', data.scores.flow);
            updateScore('score-contrast', data.scores.contrast);
            updateScore('score-access', data.scores.access);
            updateScore('score-structure', data.scores.structure);
            updateScore('score-friction', data.scores.friction);

            // 01. Visual Flow
            document.getElementById('flow-verdict').innerText = data.scores.flow > 80 
                ? "ECCELLENTE: L'occhio viene guidato naturalmente verso la CTA." 
                : (data.scores.flow > 65 
                    ? "BUONO: Il percorso visivo è generalmente chiaro ma potrebbe essere ottimizzato." 
                    : "MIGLIORABILE: Il percorso visivo è confuso, l'utente si perde tra troppi elementi.");
            document.getElementById('flow-stop').innerText = data.scores.flow > 75 ? "ALTA (Thumb-Stopper)" : (data.scores.flow > 60 ? "MEDIA" : "BASSA (Scroll-Through)");

            // 02. Contrast
            const cBox = document.getElementById('contrast-box');
            const contrastDetailEl = document.getElementById('contrast-detail');
            if(data.scores.contrast > 85) {
                cBox.className = "p-8 rounded-[2.5rem] mb-8 border-l-8 bg-green-500/10 border-green-500";
                contrastDetailEl.innerText = "Contrasto eccellente. I testi e gli elementi chiave sono immediatamente distinguibili.";
            } else if(data.scores.contrast > 70) {
                cBox.className = "p-8 rounded-[2.5rem] mb-8 border-l-8 bg-amber-500/10 border-amber-500";
                contrastDetailEl.innerText = "Contrasto buono ma potrebbe essere migliorato per la visibilità su mobile.";
            } else {
                cBox.className = "p-8 rounded-[2.5rem] mb-8 border-l-8 bg-red-500/10 border-red-500";
                contrastDetailEl.innerText = "Contrasto insufficiente. I testi rischiano di confondersi con lo sfondo, specialmente su schermi esterni.";
            }
            
            // Update contrast metrics display
            document.getElementById('color-emotion').innerText = data.scores.contrast > 80 ? "Elevato" : (data.scores.contrast > 65 ? "Medio" : "Basso");
            document.getElementById('color-ratio').innerText = "RMS: " + data.metrics.rmsContrast;

            // 03. Accessibility
            document.getElementById('font-bar').style.width = data.scores.access + '%';
            document.getElementById('safe-bar').style.width = (100 - (100 - data.scores.access)) + '%';
            
            // Update accessibility status badges
            const fontStatusEl = document.getElementById('font-status');
            const safeStatusEl = document.getElementById('safe-status');
            
            if (data.scores.access > 80) {
                fontStatusEl.textContent = "Ottimale";
                fontStatusEl.className = "px-3 py-1 bg-green-500/20 text-green-400 text-[10px] font-black rounded-full uppercase";
                safeStatusEl.textContent = "Sicuro";
                safeStatusEl.className = "px-3 py-1 bg-green-500/20 text-green-400 text-[10px] font-black rounded-full uppercase";
            } else if (data.scores.access > 60) {
                fontStatusEl.textContent = "Accettabile";
                fontStatusEl.className = "px-3 py-1 bg-amber-500/20 text-amber-400 text-[10px] font-black rounded-full uppercase";
                safeStatusEl.textContent = "Attenzione";
                safeStatusEl.className = "px-3 py-1 bg-amber-500/20 text-amber-400 text-[10px] font-black rounded-full uppercase";
            } else {
                fontStatusEl.textContent = "Poco Leggibile";
                fontStatusEl.className = "px-3 py-1 bg-red-500/20 text-red-400 text-[10px] font-black rounded-full uppercase";
                safeStatusEl.textContent = "Rischio";
                safeStatusEl.className = "px-3 py-1 bg-red-500/20 text-red-400 text-[10px] font-black rounded-full uppercase";
            }

            // 04. Structure
            // Generate tags based on analysis
            const tags = [];
            if (data.metrics.normalizedEntropy > 0.6) {
                tags.push("Contenuto Informativo", "Alta Densità");
            } else {
                tags.push("Minimal Design", "Spazio Negativo");
            }
            
            if (data.scores.contrast > 80) {
                tags.push("Alto Impatto Visivo");
            }
            
            if (data.metrics.aspectRatio >= 0.75 && data.metrics.aspectRatio <= 0.85) {
                tags.push("Ottimizzato Feed");
            } else if (data.metrics.aspectRatio < 0.65) {
                tags.push("Formato Verticale");
            }
            
            tags.push("Engagement Potenziale");
            
            document.getElementById('structure-tags').innerHTML = tags.map(t => 
                `<span class="px-4 py-2 bg-white/5 rounded-full text-xs font-bold border border-white/10">#${t}</span>`
            ).join('');
            
            document.getElementById('structure-intent').textContent = data.analysis.intent;
            document.getElementById('composition-analysis').textContent = data.analysis.composition;

            // 05. Friction
            document.getElementById('friction-time-val').innerText = data.metrics.entropy;
            document.getElementById('friction-verdict-txt').innerText = data.scores.friction > 70 
                ? "L'utente comprende il messaggio istantaneamente. Massima efficacia per campagne di vendita rapida." 
                : (data.scores.friction > 55 
                    ? "Il messaggio è comprensibile ma alcuni elementi creano distrazione o confusione." 
                    : "Troppi distruttori. Il cervello dell'utente impiega troppo tempo a capire cosa stai offrendo.");
            
            // Friction actions
            document.getElementById('friction-actions').innerHTML = data.analysis.frictionActions.map(a => 
                `<li class="flex items-start gap-2"><i class="fas fa-minus text-red-400 mt-1"></i> <span>${a}</span></li>`
            ).join('');

            // Final Summary
            const frictionTime = (0.5 + (100 - data.scores.friction)/50).toFixed(2);
            document.getElementById('final-summary').innerText = `Il contenuto ha un potenziale di conversione del ${data.scores.flow}%. L'analisi dei pixel rivela ${data.analysis.composition.toLowerCase()}. Per massimizzare i risultati, concentrati su: ${data.analysis.frictionActions[0].toLowerCase()}. L'utente tipo decodifica questo asset in circa ${frictionTime} secondi: assicurati che in questo lasso di tempo la tua offerta sia chiara.`;

            // Draw heatmap
            drawHeatmap();
        }

        function showPillar(pillarId) {
            // Remove active class from all tabs and cards
            document.querySelectorAll('.analysis-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.score-card').forEach(c => c.classList.remove('bg-white/10', 'border-purple-400'));
            
            // Add active class to selected tab and card
            document.getElementById(`pillar-${pillarId}`).classList.add('active');
            event.currentTarget.classList.add('bg-white/10', 'border-purple-400');
        }

        function drawHeatmap() {
            const canvas = document.getElementById('heatmapCanvas');
            const ctx = canvas.getContext('2d');
            const img = document.getElementById('previewImg');
            
            // Set canvas size to match image display size
            const displayWidth = img.clientWidth;
            const displayHeight = img.clientHeight;
            canvas.width = displayWidth;
            canvas.height = displayHeight;
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw heatmap points
            data.hotpoints.forEach(p => {
                const x = p.x * canvas.width;
                const y = p.y * canvas.height;
                const radius = 100 * p.v; // Base radius scaled by visibility
                const grad = ctx.createRadialGradient(x, y, 0, x, y, radius);
                grad.addColorStop(0, `rgba(139, 92, 246, ${0.6 * p.v})`);
                grad.addColorStop(0.4, `rgba(236, 72, 153, ${0.3 * p.v})`);
                grad.addColorStop(1, 'rgba(0, 0, 0, 0)');
                
                ctx.fillStyle = grad;
                ctx.beginPath();
                ctx.arc(x, y, radius, 0, Math.PI * 2);
                ctx.fill();
            });
        }

        // Redraw heatmap on window resize
        window.addEventListener('resize', () => { 
            if (data.hotpoints) drawHeatmap(); 
        });
        
        // Initialize with a sample analysis after 3 seconds for demo purposes
        setTimeout(() => {
            if (document.getElementById('welcome').classList.contains('hidden') === false) {
                // Load a sample image for demo
                previewImg.src = 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="400" height="500" viewBox="0 0 400 500"><rect width="400" height="500" fill="%231e293b"/><circle cx="200" cy="180" r="60" fill="%238b5cf6" opacity="0.8"/><rect x="140" y="260" width="120" height="40" rx="20" fill="%23ec4899" opacity="0.9"/><text x="200" y="360" font-family="Arial" font-size="24" fill="white" text-anchor="middle">Sample Post</text><rect x="80" y="400" width="240" height="50" rx="25" fill="%2338bdf8" opacity="0.9"/><text x="200" y="432" font-family="Arial" font-size="20" fill="white" text-anchor="middle">SCOPRI DI PIÙ</text></svg>';
                previewImg.onload = () => {
                    document.getElementById('welcome').classList.add('hidden');
                    document.getElementById('loader').classList.remove('hidden');
                    setTimeout(() => {
                        data = computeRealMetrics(previewImg);
                        renderDashboard();
                    }, 1000);
                };
            }
        }, 3000);
    </script>
</body>
</html>
