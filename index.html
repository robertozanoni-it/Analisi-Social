<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Creative Executive Hub - Strategist Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Outfit:wght@400;700;900&display=swap');
        
        :root {
            --accent: #ec4899;
            --primary: #6366f1;
            --bg: #0b0f1a;
        }

        body { font-family: 'Inter', sans-serif; background-color: var(--bg); color: #ffffff; overflow-x: hidden; }
        h1, h2, h3, h4, .font-outfit { font-family: 'Outfit', sans-serif; }

        .glass { background: rgba(23, 32, 53, 0.8); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.05); }
        .gradient-text { background: linear-gradient(to right, #818cf8, #ec4899); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        .loader { width: 40px; height: 40px; border: 3px solid rgba(99, 102, 241, 0.1); border-top-color: var(--primary); border-radius: 50%; animation: spin 0.8s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

        .btn-primary { background: linear-gradient(135deg, var(--primary), var(--accent)); transition: all 0.3s ease; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 10px 20px -10px var(--primary); }

        .tab-active { color: #ffffff !important; border-bottom: 4px solid var(--accent); opacity: 1 !important; transform: translateY(-2px); }

        .mockup-container { width: 320px; height: 580px; background: #000; border-radius: 35px; overflow: hidden; border: 8px solid #1f2937; position: relative; }
        
        #heatmapOverlay { pointer-events: none; mix-blend-mode: overlay; opacity: 0.6; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        .solution-card { transition: all 0.3s ease; }
        .solution-card:hover { border-color: rgba(99, 102, 241, 0.4); background: rgba(99, 102, 241, 0.05); }

        @media print { .no-print { display: none !important; } }
    </style>
</head>
<body class="p-0 m-0">

    <nav class="sticky top-0 z-50 glass border-b border-white/5 px-8 py-4 no-print">
        <div class="max-w-[1600px] mx-auto flex justify-between items-center">
            <div class="flex items-center gap-4">
                <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-indigo-500 to-pink-500 flex items-center justify-center shadow-lg">
                    <i class="fas fa-rocket text-white"></i>
                </div>
                <div>
                    <h1 class="text-xl font-black tracking-tight leading-none text-white">STRATEGIST<span class="text-pink-500 italic">HUB</span></h1>
                    <p class="text-[9px] uppercase tracking-[0.3em] text-white/60 font-bold">SEO & PNL Conversion Engine</p>
                </div>
            </div>
            <div id="navActions" class="hidden flex items-center gap-6">
                <button onclick="window.print()" class="text-xs font-bold uppercase tracking-widest hover:text-pink-500 transition text-white">
                    <i class="fas fa-file-pdf mr-2"></i> Report Strategico
                </button>
                <button onclick="location.reload()" class="btn-primary px-6 py-2.5 rounded-full text-xs font-black uppercase tracking-widest text-white shadow-xl">
                    Nuovo Audit
                </button>
            </div>
        </div>
    </nav>

    <main class="max-w-[1600px] mx-auto p-8">
        
        <section id="welcome" class="py-20 text-center">
            <h2 class="text-6xl md:text-8xl font-black tracking-tighter mb-6 font-outfit text-white">
                Analisi.<br><span class="gradient-text">Soluzione. Vendita.</span>
            </h2>
            <p class="text-white max-w-2xl mx-auto text-lg mb-12 opacity-90">
                Hub integrato per SEO specialist e content creator. Trasforma asset visivi in macchine da conversione.
            </p>
            
            <div id="dropZone" class="max-w-xl mx-auto glass rounded-[2.5rem] p-12 border-2 border-dashed border-white/10 hover:border-indigo-500/50 transition-all cursor-pointer group">
                <input type="file" id="fileInput" class="hidden" accept="image/*">
                <div class="flex flex-col items-center">
                    <div class="w-20 h-20 rounded-full bg-indigo-500/10 flex items-center justify-center mb-6 group-hover:scale-110 transition duration-500">
                        <i class="fas fa-cloud-upload-alt text-3xl text-indigo-400"></i>
                    </div>
                    <span class="text-xl font-bold mb-2 text-white">Carica l'asset da ottimizzare</span>
                    <span class="text-white/60 text-sm italic">Analisi PNL, SEO & UX Matrice Soluzioni</span>
                </div>
            </div>
        </section>

        <div id="loader" class="hidden py-32 flex flex-col items-center">
            <div class="loader mb-6"></div>
            <p class="text-indigo-400 font-black uppercase tracking-widest text-[10px] animate-pulse">Generazione Matrice Soluzioni Strategiche...</p>
        </div>

        <div id="dashboard" class="hidden space-y-8 animate-fade-in">
            <!-- Top Stats - Nuovi parametri -->
            <div class="grid grid-cols-1 md:grid-cols-4 lg:grid-cols-5 gap-4">
                <div class="glass p-6 rounded-3xl border-l-4 border-indigo-500">
                    <span class="text-[9px] font-black uppercase text-indigo-400">Engagement Potential</span>
                    <div id="impactScore" class="text-3xl font-black text-white">--</div>
                </div>
                <div class="glass p-6 rounded-3xl border-l-4 border-pink-500">
                    <span class="text-[9px] font-black uppercase text-pink-400">Attention Grip</span>
                    <div id="attentionScore" class="text-3xl font-black text-white">--</div>
                </div>
                <div class="glass p-6 rounded-3xl border-l-4 border-emerald-500">
                    <span class="text-[9px] font-black uppercase text-emerald-400">Readability Score</span>
                    <div id="readabilityScore" class="text-3xl font-black text-white">--</div>
                </div>
                <div class="glass p-6 rounded-3xl border-l-4 border-amber-500">
                    <span class="text-[9px] font-black uppercase text-amber-500">Contrast Ratio (UX)</span>
                    <div id="contrastScore" class="text-3xl font-black text-white">--</div>
                </div>
                <div class="glass p-6 rounded-3xl border-l-4 border-purple-500">
                    <span class="text-[9px] font-black uppercase text-purple-400">Trust Factor</span>
                    <div id="trustScore" class="text-3xl font-black text-white">--</div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
                
                <!-- Colonna Sinistra -->
                <div class="lg:col-span-4 space-y-6">
                    <div class="glass rounded-[2rem] p-6 sticky top-28">
                        <h3 class="text-xs font-black uppercase text-white/50 tracking-widest mb-4">Focus & Heatmap</h3>
                        
                        <div class="relative rounded-2xl overflow-hidden shadow-2xl bg-black mb-4">
                            <img id="previewImg" class="w-full">
                            <canvas id="heatmapOverlay" class="absolute inset-0 w-full h-full opacity-0 transition-opacity duration-700"></canvas>
                        </div>
                        
                        <button onclick="toggleHeatmap()" class="w-full text-[10px] font-black uppercase tracking-widest py-3 rounded-xl border border-white/10 hover:bg-white/5 transition text-white">
                            <i class="fas fa-expand-arrows-alt mr-2"></i> Mostra Punti Focali
                        </button>

                        <!-- Color Psychology Card - FIXED TEXT CASE -->
                        <div class="mt-8 p-8 rounded-[2rem] border-2 border-amber-500/20 bg-slate-900/50">
                            <h4 class="text-[10px] font-black uppercase text-amber-500 mb-6 tracking-[0.2em]">Color Psychology</h4>
                            <div id="colorFeeling" class="text-2xl font-bold text-white leading-snug">
                                <!-- Testo caricato dinamicamente -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Colonna Destra -->
                <div class="lg:col-span-8 space-y-8">
                    <div class="glass rounded-[3rem] p-8">
                        <!-- TAB NAVIGATION -->
                        <div class="flex flex-col md:flex-row gap-8 border-b border-white/5 mb-10 no-scrollbar overflow-x-auto">
                            <button onclick="switchTab('seo')" id="btn-seo" class="pb-6 text-2xl font-black uppercase tracking-tighter transition-all opacity-40 hover:opacity-100 tab-active">
                                Audit SEO & UX
                            </button>
                            <button onclick="switchTab('pnl')" id="btn-pnl" class="pb-6 text-2xl font-black uppercase tracking-tighter transition-all opacity-40 hover:opacity-100">
                                Persuasione PNL
                            </button>
                            <button onclick="switchTab('social')" id="btn-social" class="pb-6 text-2xl font-black uppercase tracking-tighter transition-all opacity-40 hover:opacity-100">
                                Social Simulator
                            </button>
                        </div>

                        <!-- SEO Tab -->
                        <div id="tab-seo" class="space-y-8">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="p-8 bg-slate-800/40 rounded-3xl border border-white/5">
                                    <h5 class="flex items-center text-xs font-black uppercase text-indigo-400 mb-4">
                                        <i class="fas fa-flag-it mr-2"></i> Strategia SEO Italia
                                    </h5>
                                    <p id="seoIt" class="text-sm text-white leading-relaxed opacity-90"></p>
                                </div>
                                <div class="p-8 bg-slate-800/40 rounded-3xl border border-white/5">
                                    <h5 class="flex items-center text-xs font-black uppercase text-pink-400 mb-4">
                                        <i class="fas fa-flag-gb mr-2"></i> International SEO UK
                                    </h5>
                                    <p id="seoUk" class="text-sm text-white leading-relaxed opacity-90"></p>
                                </div>
                            </div>

                            <!-- NUOVA SEZIONE MATRICE SOLUZIONI -->
                            <div class="mt-8">
                                <h5 class="text-xs font-black uppercase text-emerald-400 mb-6 flex items-center">
                                    <i class="fas fa-tools mr-2"></i> Matrice Problema-Soluzione (CRO & UX)
                                </h5>
                                <div id="solutionMatrix" class="grid grid-cols-1 gap-4">
                                    <!-- Caricato via JS -->
                                </div>
                            </div>
                            
                            <div class="p-8 bg-white/5 rounded-3xl border border-white/10 mt-8">
                                <h5 class="text-[10px] font-black uppercase text-white/40 mb-4 tracking-[0.2em]">Semantic & LSI Keywords</h5>
                                <div id="kwList" class="flex flex-wrap gap-2"></div>
                            </div>
                        </div>

                        <!-- PNL Tab -->
                        <div id="tab-pnl" class="hidden space-y-6">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div class="p-6 rounded-2xl border border-white/5 bg-slate-800/40 border-t-4 border-t-indigo-500">
                                    <span class="text-[9px] font-black text-indigo-400 uppercase">Visivo (V)</span>
                                    <p class="text-xs text-white mt-2 leading-relaxed" id="visivoDesc"></p>
                                </div>
                                <div class="p-6 rounded-2xl border border-white/5 bg-slate-800/40 border-t-4 border-t-pink-500">
                                    <span class="text-[9px] font-black text-pink-400 uppercase">Auditivo (A)</span>
                                    <p class="text-xs text-white mt-2 leading-relaxed" id="auditivoDesc"></p>
                                </div>
                                <div class="p-6 rounded-2xl border border-white/5 bg-slate-800/40 border-t-4 border-t-emerald-500">
                                    <span class="text-[9px] font-black text-emerald-400 uppercase">Cinestesico (K)</span>
                                    <p class="text-xs text-white mt-2 leading-relaxed" id="cinestesicoDesc"></p>
                                </div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="pnlTriggers"></div>
                        </div>

                        <!-- Social Simulator -->
                        <div id="tab-social" class="hidden space-y-8 text-white">
                            <div class="flex justify-center gap-3 no-scrollbar overflow-x-auto pb-6">
                                <button onclick="setPlatform('instagram')" class="platform-btn px-8 py-3 rounded-xl glass text-[10px] font-black uppercase tracking-widest hover:bg-white/10 transition" data-target="instagram">Instagram</button>
                                <button onclick="setPlatform('facebook')" class="platform-btn px-8 py-3 rounded-xl glass text-[10px] font-black uppercase tracking-widest hover:bg-white/10 transition" data-target="facebook">Facebook</button>
                                <button onclick="setPlatform('linkedin')" class="platform-btn px-8 py-3 rounded-xl glass text-[10px] font-black uppercase tracking-widest hover:bg-white/10 transition" data-target="linkedin">LinkedIn</button>
                            </div>

                            <div class="flex flex-col xl:flex-row gap-12 items-start justify-center">
                                <div id="socialMockup" class="mockup-container shadow-2xl flex-shrink-0">
                                    <div id="mockupContent" class="h-full flex flex-col"></div>
                                </div>
                                <div class="flex-grow space-y-6 max-w-xl">
                                    <div class="p-8 glass rounded-[2.5rem] border border-white/10">
                                        <h4 id="platformTitle" class="text-2xl font-black mb-3 uppercase tracking-tighter"></h4>
                                        <div id="platformStrategy" class="text-xs text-indigo-400 font-black mb-6 uppercase tracking-widest"></div>
                                        <div class="p-6 bg-black/40 rounded-2xl text-sm italic leading-relaxed border border-white/5" id="fullCaptionText"></div>
                                    </div>
                                    <div id="socialHashtags" class="flex flex-wrap gap-2 text-[10px] font-mono text-pink-400 font-bold bg-pink-500/5 p-4 rounded-xl"></div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        const apiKey = ""; 
        let currentData = null;
        let heatmapActive = false;

        const fileInput = document.getElementById('fileInput');
        document.getElementById('dropZone').onclick = () => fileInput.click();
        
        fileInput.onchange = (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (ev) => {
                    const b64 = ev.target.result;
                    document.getElementById('previewImg').src = b64;
                    analyzeAsset(b64);
                };
                reader.readAsDataURL(file);
            }
        };

        async function analyzeAsset(base64) {
            document.getElementById('welcome').classList.add('hidden');
            document.getElementById('loader').classList.remove('hidden');

            const prompt = `Analisi per Web Designer & SEO Specialist (Elementor Expert). Fornisci un JSON:
            {
                "scores": {"impact": 85, "attention": 70, "readability": 90, "contrast": 65, "trust": 80},
                "color_psychology": "Energia, stabilità e benessere. Il giallo (stimolazione) contrasta con il grigio (professionalità)...",
                "seo": {"it": "Strategia...", "uk": "Strategy...", "keywords": ["..."]},
                "solutions": [
                    {"problem": "Titolo poco leggibile su sfondo giallo", "solution": "Aggiungi un text-shadow o un box scuro semitrasparente in Elementor", "priority": "High"},
                    {"problem": "Assenza di CTA chiara", "solution": "Inserire bottone con contrasto elevato (colore opposto sulla ruota)", "priority": "Urgent"}
                ],
                "pnl": {
                    "sensorial": {"visivo": "...", "auditivo": "...", "cinestesico": "..."},
                    "triggers": [{"name": "...", "desc": "..."}]
                },
                "platforms": {
                    "instagram": {"caption": "...", "strategy": "...", "tags": "..."},
                    "facebook": {"caption": "...", "strategy": "...", "tags": "..."},
                    "linkedin": {"caption": "...", "strategy": "...", "tags": "..."}
                },
                "heatmap": [{"x": 0.5, "y": 0.4, "strength": 0.8}]
            }`;

            try {
                const resp = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        contents: [{
                            parts: [
                                {text: "Analizza l'immagine caricata fornendo soluzioni tecniche WordPress/Elementor per i problemi UX/SEO rilevati. Mantieni il testo della psicologia dei colori in formato normale (Maiuscolo/Minuscolo)."},
                                {inlineData: {mimeType: "image/png", data: base64.split(',')[1]}}
                            ]
                        }],
                        systemInstruction: { parts: [{ text: prompt }] },
                        generationConfig: { responseMimeType: "application/json" }
                    })
                });

                const json = await resp.json();
                currentData = JSON.parse(json.candidates[0].content.parts[0].text);
                renderDashboard();
                drawHeatmap();
            } catch (err) {
                console.error(err);
                alert("Errore nell'analisi. Ricarica e riprova.");
            }
        }

        function renderDashboard() {
            document.getElementById('loader').classList.add('hidden');
            document.getElementById('dashboard').classList.remove('hidden');
            document.getElementById('navActions').classList.remove('hidden');

            document.getElementById('impactScore').innerText = currentData.scores.impact + '%';
            document.getElementById('attentionScore').innerText = currentData.scores.attention + '%';
            document.getElementById('readabilityScore').innerText = currentData.scores.readability + '%';
            document.getElementById('contrastScore').innerText = currentData.scores.contrast + '%';
            document.getElementById('trustScore').innerText = currentData.scores.trust + '%';

            // FIXED: Maiuscolo/Minuscolo
            document.getElementById('colorFeeling').innerText = currentData.color_psychology;
            
            document.getElementById('seoIt').innerText = currentData.seo.it;
            document.getElementById('seoUk').innerText = currentData.seo.uk;
            
            // Render Solution Matrix
            document.getElementById('solutionMatrix').innerHTML = currentData.solutions.map(s => `
                <div class="solution-card p-6 glass rounded-2xl border-l-4 ${s.priority === 'Urgent' ? 'border-red-500' : 'border-indigo-500'} flex flex-col md:flex-row gap-6 items-start">
                    <div class="flex-shrink-0 bg-white/5 p-3 rounded-lg text-xs font-black uppercase text-white/50">${s.priority}</div>
                    <div>
                        <p class="text-[10px] font-black uppercase text-pink-500 mb-1">Criticità Rilevata</p>
                        <p class="text-sm font-bold text-white mb-3">${s.problem}</p>
                        <p class="text-[10px] font-black uppercase text-emerald-500 mb-1">Soluzione Tecnica</p>
                        <p class="text-xs text-white opacity-80 leading-relaxed">${s.solution}</p>
                    </div>
                </div>
            `).join('');

            document.getElementById('kwList').innerHTML = currentData.seo.keywords.map(k => 
                `<span class="bg-indigo-500/10 border border-indigo-500/20 px-4 py-1.5 rounded-full text-[10px] font-bold text-white uppercase">#${k}</span>`
            ).join('');

            document.getElementById('visivoDesc').innerText = currentData.pnl.sensorial.visivo;
            document.getElementById('auditivoDesc').innerText = currentData.pnl.sensorial.auditivo;
            document.getElementById('cinestesicoDesc').innerText = currentData.pnl.sensorial.cinestesico;
            
            document.getElementById('pnlTriggers').innerHTML = currentData.pnl.triggers.map(t => `
                <div class="p-6 glass rounded-2xl border-l-4 border-pink-500">
                    <h6 class="text-xs font-black uppercase text-pink-500 mb-2 tracking-widest">${t.name}</h6>
                    <p class="text-xs text-white leading-relaxed opacity-90">${t.desc}</p>
                </div>
            `).join('');

            setPlatform('instagram');
        }

        function drawHeatmap() {
            const canvas = document.getElementById('heatmapOverlay');
            const ctx = canvas.getContext('2d');
            const img = document.getElementById('previewImg');
            canvas.width = img.clientWidth;
            canvas.height = img.clientHeight;

            currentData.heatmap.forEach(point => {
                const x = point.x * canvas.width;
                const y = point.y * canvas.height;
                const rad = 80 * point.strength;
                const grad = ctx.createRadialGradient(x, y, 0, x, y, rad);
                grad.addColorStop(0, 'rgba(255, 0, 0, 1)');
                grad.addColorStop(1, 'rgba(255, 255, 0, 0)');
                ctx.fillStyle = grad;
                ctx.fillRect(x - rad, y - rad, rad * 2, rad * 2);
            });
        }

        function toggleHeatmap() {
            heatmapActive = !heatmapActive;
            document.getElementById('heatmapOverlay').style.opacity = heatmapActive ? '0.7' : '0';
        }

        function setPlatform(platform) {
            const pData = currentData.platforms[platform];
            const content = document.getElementById('mockupContent');
            const img = document.getElementById('previewImg').src;

            document.querySelectorAll('.platform-btn').forEach(b => {
                b.classList.toggle('tab-active', b.dataset.target === platform);
            });

            document.getElementById('platformTitle').innerText = platform;
            document.getElementById('platformStrategy').innerText = pData.strategy;
            document.getElementById('fullCaptionText').innerText = pData.caption;
            document.getElementById('socialHashtags').innerText = pData.tags;

            let html = '';
            if (platform === 'instagram') {
                html = `<div class="p-4 flex items-center gap-3 bg-black"><div class="w-8 h-8 rounded-full bg-slate-800"></div><span class="text-[10px] font-bold text-white">tuo_brand</span></div><img src="${img}" class="w-full aspect-square object-cover"><div class="p-4 space-y-3"><div class="flex gap-4 text-xl text-white"><i class="far fa-heart"></i><i class="far fa-comment"></i></div><p class="text-[11px] text-white leading-relaxed line-clamp-2">${pData.caption}</p></div>`;
            } else if (platform === 'facebook') {
                html = `<div class="p-3 bg-[#242526] flex items-center gap-3"><div class="w-10 h-10 rounded-full bg-slate-700"></div><div><p class="text-[11px] font-bold text-white">Tuo Brand</p><p class="text-[9px] text-white/50">Sponsored</p></div></div><div class="p-4 text-[12px] text-white leading-relaxed bg-[#1c1e21] flex-grow overflow-y-auto">${pData.caption}</div><img src="${img}" class="w-full object-cover">`;
            } else if (platform === 'linkedin') {
                html = `<div class="bg-white h-full"><div class="p-4 flex items-center gap-3 border-b"><div class="w-10 h-10 bg-indigo-900 text-white flex items-center justify-center font-bold">B</div><div><p class="text-[11px] font-bold text-black">Brand Hub</p><p class="text-[9px] text-slate-500 italic">2.340 follower</p></div></div><div class="p-4 text-[12px] text-slate-800 leading-relaxed">${pData.caption}</div><img src="${img}" class="w-full object-cover"></div>`;
            }
            content.innerHTML = html;
        }

        function switchTab(id) {
            ['seo', 'pnl', 'social'].forEach(t => {
                document.getElementById(`tab-${t}`).classList.add('hidden');
                document.getElementById(`btn-${t}`).classList.remove('tab-active');
                document.getElementById(`btn-${t}`).style.opacity = '0.4';
            });
            document.getElementById(`tab-${id}`).classList.remove('hidden');
            document.getElementById(`btn-${id}`).classList.add('tab-active');
            document.getElementById(`btn-${id}`).style.opacity = '1';
        }
    </script>
</body>
</html>
